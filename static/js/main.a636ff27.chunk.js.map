{"version":3,"sources":["phaser/trapper/sound.js","phaser/trapper/spawn.js","services/game/status-slice.ts","phaser/trapper/utils/values.js","services/game/metrics-slice.ts","phaser/trapper/entities/raccoon.js","phaser/trapper/entities/player.js","phaser/trapper/entities/stat-bar.js","phaser/event-emitter.js","phaser/trapper/entities/bowl.js","phaser/trapper/index.js","services/ui/ui-slice.ts","services/game/reducer.ts","services/store.ts","phaser/trapper/entities/status.js","phaser/trapper/level.js","components/game/game-interface.tsx","themes/index.ts","services/hooks.ts","components/game/rules-checker.tsx","components/game/brain.tsx","components/game/phaser-container.tsx","components/button.tsx","components/ui/splash.tsx","components/ui/components/controls.tsx","components/ui/components/debugstats.tsx","components/ui/sidebar.tsx","components/ui/components/modals.tsx","components/ui/modals.tsx","components/ui/components/music.tsx","app/index.tsx","services/serviceWorker.ts","index.tsx"],"names":["gameContext","sceneContext","SOUNDS","SPLAT","GOOD","BAD","BOWL_LOST","BOWL_SLING","ENEMY_HUG","ENEMY_BITE","ENEMY_EATING","ENEMY_CAPTURED","ENEMY_ESCAPED","KICK","CHARGE","PLAYER_HUG","CHANGE_LANE","init","sContext","gContext","preload","load","audioSprite","playSound","soundKey","params","sound","addAudioSprite","play","cancelSound","soundThing","remove","player","lastSentActiveEnemies","spawnFrequency","curTicker","spawnPositions","defGlobalEntities","defEnemyEntities","defLaneSpawns","groups","entityTypes","Raccoon","Entity","rollForSpawns","laneSpawnData","spawnCommands","enemies","forEach","lane","idx","enemy","Math","random","rate","push","type","laneIdx","getSpawnCommands","spawnCount","sData","eData","spawnIt","console","error","throttledUpdate","throttle","global","gameActive","updateSpawnCount","children","each","entity","EntityRef","entityData","statsObj","pos","stats","speed","Phaser","FloatBetween","jumpRate","x","y","depth","getDepthOfLane","misc","particleDeath","randomScale","scaleRange","setScale","spawnStatus","Status","spawnPlayer","laneData","Player","activeEnemies","countActive","Events","emit","external_setSpawnFrequency","newValue","sliderPosition","minV","log","scale","round","exp","formatSliderValue","exportMap","setContext","context","initSpritesheet","Bowl","create","globalEntities","levelData","sceneData","lanes","map","pO","parseInt","l","spawns","physics","add","group","bowls","staticGroup","initSprites","update","spawn","key","anim","item","anims","spawnBowl","setVelocity","bowl","spawnSpeed","slingBowl","statusSlice","createSlice","name","initialState","gameStatus","playStatus","playStatusReason","reducers","startGame","state","exitGame","winRound","reason","payload","loseRound","actions","selectGameStatus","game","status","selectPlayStatus","getModalFromGameStatus","createSelector","some","s","ReselectModalFromGameStatus","useSelector","Values","zindex","BACKGROUND","LANE_1","LANE_2","LANE_3","LANE_4","FOREGROUND","offset","isNaN","e","hugs","bites","captures","escapes","scoreModifiers","metricsSlice","setMetric","action","undefined","value","extraReducers","builder","addCase","selectMetrics","Object","keys","metrics","filter","sKey","k","isGood","selectMetricsMap","selectGoodMetrics","selectBadMetrics","selectScore","total","getScore","selectActiveEnemies","sceneRef","STATUS","ROAMING","EATING","ROAMING_TAME","DEAD","HUGGING","IDLE","CAPTURED","ESCAPED","BITING","spriteKey","velocityRanges","LIL_PUNT","min","max","diff","BIG_PUNT","scene","physicsGroup","spawnData","deathTimer","destroyTimer","punted","eatingSound","isFull","eatOffset","curPhysState","curAnimState","puntKillThreshold","feedable","setDepth","existing","setBounce","setCollideWorldBounds","allowGravity","body","setSize","setStatus","setInteractive","tint","setTint","this","kill","isAlive","touching","down","velocity","force","vRange","puntedTimer","time","delayedCall","setDrag","quickKill","destroy","flipX","animKey","getAnimationForState","curAnim","playAnimationForKey","adjustMovementForState","given","isMovingStatus","moveStop","bowlBody","detune","Between","eatRate","volume","statusKey","modifier","moveNormal","resumeStatus","delayedDestroy","Physics","Arcade","Sprite","frames","frame","frameRate","repeat","generateFrameNumbers","start","end","spritesheet","frameWidth","frameHeight","statBar","OFFSET","progress","setPosition","cellIdx","floor","FEED","KICK_PREP","ATTACKED","animationStatus","gameState","recoveryTimer","hpRange","hp","laneValues","parseLaneData","posOffset","spriteOffset","lastIntent","chargeSound","kickCharge","setOrigin","refreshBody","updatePlayerPosition","cursors","input","keyboard","createCursorKeys","StatBar","changeLane","width","maxIdx","length","realPos","setOffsetPosition","cancelKick","setLaneDepth","statusKeys","indexOf","setProgress","checkStatuses","getModifiedKickCharge","checkStatus","intent","getIntentFromStateAndKeys","startKick","kick","startHug","cancelHug","up","isDown","right","left","chargeKick","playStatusAnimation","playAnimationForStatus","eventEmitter","EventEmitter","drainRate","drainStart","drainTimer","feeding","canBeEaten","startDrainTimer","onDrainTimer","Date","drainAmount","emptyBowl","enemyEntity","addToDrainRate","feeder","bowlEmpty","levelGroups","INITIAL_STATE_POINTS","points","gameData","curLevel","particleDefs","blood","image","emitter","quantity","visible","blendMode","angle","lifespan","gravityY","raccoon","atlas","cycle","frequency","raccoon_mean","particles","createGame","config","AUTO","parent","mode","Scale","FIT","autoCenter","CENTER_BOTH","height","zoom","autoRound","default","arcade","gravity","debug","Game","LevelController","SpawnController","initSound","preloadSound","getScene","level","levels","scenes","sceneKey","on","onInterface","spawnGroups","entities","collider","platforms","collider_enemyAndPlatform","overlap","trigger_enemyAndBowl","leftTrigger","trigger_itemAtStart","rightTrigger","trigger_enemyAtEnd","trigger_enemyAndPlayer","onObjectClicked","onKeyDown","event","data","gameInterface","trigger","STATUS_ENEMY","setPoints","captured","escaped","canEat","eatAtBowl","eatenBy","platform","STATUS_PLAYER","getKickStrength","kickStrength","punt","willKill","showParticle","thudVolume","kickEnemy","hug","onHugEnemy","hugEnemy","bite","onAttackedByEnemy","bitePlayer","pointer","gameObject","worldX","worldY","clicked","pDef","pEmitter","createEmitter","explode","stopGame","stop","setLevel","levelIdx","code","change","updateScoreboard","pauseGame","pause","resumeGame","resume","killGame","fetchThing","amount","Promise","resolve","setTimeout","incrementAsync","createAsyncThunk","a","response","uiSlice","increment","decrement","incrementByAmount","pending","fulfilled","combineReducers","metricsReducer","statusReducer","store","configureStore","reducer","ui","uiReducer","gameReducer","SPRITE_KEY","rY","rX","statType","playAnimationForType","vX","vY","alpha","tweens","targets","duration","delay","ease","TRIGGER_DIMS","triggerY","platformWidth","setDisplaySize","setAlpha","createGameInterface","dispatch","createGlobalStyle","getColor","colorId","colors","black","white","grey","grey_light","grey_dark","pink","brown","brown_light","brown_dark","tan","red","green","green_light","shadows","z1","z2","z3","breakpoints","mobile_tiny","mobile_medium","mobile_large","tablet","desktop","useAppSelector","checkMetricRule","metricRule","stateValue","condition","criteria","evaluateExpression","evaluateGameCondition","gameCondition","results","i","gc","when","Brain","useDispatch","useEffect","rules","RulesJson","TRAPPER","metricRules","stateMetrics","m","metric","result","gameConditions","resultObjs","passedCondition","then","halt","evaluateGameConditions","conditions","resultAction","ScPhaserContainer","styled","div","ScWrapper","PhaserContainer","id","ScButton","Button","onClick","text","ScSplash","ScBg","ScBody","ScButtons","h1","ScLogo","Splash","navigate","useNavigate","title","onGameClick","ScControls","ScEnemies","Controls","useState","setSpawnSpeed","className","onChange","target","ScStats","ScStatGroup","p","css","ScStat","ScDebug","DebugStats","goodStats","badStats","score","ScSidebar","ScBottom","ScTop","ScLink","Link","ScHelp","ScSideImage","HelpList","Sidebar","collapsed","setCollapsed","to","ScModal","WonModal","LostModal","PausedModal","MultiModal","playStatusObj","ScModals","Modals","ScMusic","Music","playing","setPlaying","useSound","ScStage","RouteReader","location","useLocation","pathname","App","pages","route","element","path","Boolean","window","hostname","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.a636ff27.chunk.js","sourcesContent":["\r\nlet gameContext;\r\nlet sceneContext;\r\n\r\nexport const SOUNDS = {\r\n  SPLAT: 'crash',\r\n  GOOD: 'beepUp',\r\n  BAD: 'beepDown',\r\n  BOWL_LOST: 'beepBoop',\r\n  BOWL_SLING: 'charge_slice',\r\n  ENEMY_HUG: 'beepUp',\r\n  ENEMY_BITE: 'chomp',\r\n  ENEMY_EATING: 'chomp_repeat',\r\n  ENEMY_CAPTURED: 'beepUp',\r\n  ENEMY_ESCAPED: 'badBeep',\r\n  KICK: 'bigPunt',\r\n  CHARGE: 'chargeUp',\r\n  PLAYER_HUG: 'beep',\r\n  CHANGE_LANE: 'beepDown_slice'\r\n}\r\n\r\nexport const init = (sContext, gContext) => {\r\n  gameContext = gContext;\r\n  sceneContext = sContext;\r\n}\r\n\r\nexport const preload = () => {\r\n  sceneContext.load.audioSprite('sfx', './assets/sfx/sfx.json', [ 'assets/sfx/sfx.ogg', 'assets/sfx/sfx.mp3'] );\r\n}\r\n\r\nexport const playSound = (soundKey, params = {}) => {\r\n  const sound = gameContext.sound.addAudioSprite('sfx');\r\n  sound.play(soundKey, params);\r\n  return sound;\r\n}\r\n\r\nexport const cancelSound = soundThing => {\r\n  return gameContext.sound.remove(soundThing)\r\n}","import Phaser from 'phaser';\r\n\r\nimport Raccoon from './entities/raccoon';\r\nimport Player from './entities/player';\r\nimport Bowl from './entities/bowl';\r\nimport Status from './entities/status';\r\nimport { getDepthOfLane } from './utils/values';\r\nimport { throttle } from 'throttle-debounce';\r\nimport Events from '../event-emitter';\r\nimport { playSound, SOUNDS } from './sound';\r\n\r\nconst THROTTLE_SPEED = 150;\r\nconst SPAWN_MIN = 1000;\r\nconst SPAWN_MAX = 1;\r\nconst SPAWN_LIMIT = -1;\r\n\r\nlet spawnCount = 0;\r\nlet lastSentActiveEnemies = 0;\r\nlet spawnFrequency = null; // how often to roll dice for spawns\r\nlet curTicker = 0;\r\nlet spawnPositions = [];\r\nlet defGlobalEntities = {};\r\nlet defEnemyEntities = [];\r\nlet defLaneSpawns = [];\r\n\r\nconst groups = {};\r\nlet player;\r\nlet sceneContext;\r\n\r\nconst entityTypes = {\r\n  'raccoon': Raccoon.Entity\r\n}\r\n\r\n\r\nexport const setContext = (context) => {\r\n  sceneContext = context;\r\n}\r\n\r\nexport const preload = () => {\r\n  Raccoon.initSpritesheet(sceneContext);\r\n  Player.initSpritesheet(sceneContext);\r\n  Bowl.initSpritesheet(sceneContext);\r\n  Status.initSpritesheet(sceneContext);\r\n}\r\n\r\nexport const create = (globalEntities, levelData, sceneData) => {\r\n  spawnPositions = sceneData.lanes.map(pO => ({\r\n    x: parseInt(pO.x),\r\n    y: parseInt(pO.y) - 50\r\n  }));\r\n  defGlobalEntities = globalEntities.misc;\r\n  defEnemyEntities = globalEntities.enemies;\r\n  defLaneSpawns = levelData.lanes.map(l => l.spawns);\r\n\r\n  //- container for bad boyz\r\n  groups.enemies = sceneContext.physics.add.group();\r\n  groups.bowls = sceneContext.physics.add.group();\r\n  groups.player = sceneContext.physics.add.staticGroup();\r\n\r\n  Player.initSprites(sceneContext);\r\n  Raccoon.initSprites(sceneContext);\r\n  Bowl.initSprites(sceneContext);\r\n  Status.initSprites(sceneContext);\r\n\r\n  spawnPlayer(sceneData.lanes);\r\n  return groups;\r\n}\r\n\r\n// from the supplied data and random rolls, get a list of entites to spawn, and the lanes they should spawn in\r\nexport const getSpawnCommands = laneSpawnData => {\r\n  let enemies = [];\r\n  laneSpawnData.forEach((lane, idx) => {\r\n    lane.forEach(enemy => {\r\n      if(Math.random() < enemy.rate){\r\n        enemies.push({ \r\n          type: enemy.type, \r\n          laneIdx: idx \r\n        });\r\n      }\r\n    })\r\n  });\r\n\r\n  return enemies;\r\n}\r\n\r\nexport const rollForSpawns = laneSpawnData => {\r\n  const spawnCommands = getSpawnCommands(laneSpawnData);\r\n  let spawnCount = 0;\r\n  spawnCommands.forEach(sData => {\r\n    const eData = defEnemyEntities[sData.type];\r\n    if(entityTypes[eData.type]){\r\n      spawnIt(entityTypes[eData.type], eData, sData.laneIdx);\r\n      spawnCount++;\r\n    }else{\r\n      console.error('unknown entity type:', eData.type);\r\n    }\r\n  })\r\n\r\n  return spawnCount;\r\n}\r\n\r\nexport const update = () => {\r\n  groups.enemies.children.each(entity => {\r\n    entity.update();\r\n  });\r\n  \r\n  groups.player.children.each(entity => {\r\n    entity.update();\r\n  });\r\n\r\n  //- hack that stops spawning when slider at lowest value\r\n  if(SPAWN_LIMIT === -1 || spawnCount < SPAWN_LIMIT){\r\n    if(spawnFrequency !== SPAWN_MIN){\r\n      if(curTicker > spawnFrequency){\r\n        curTicker = 0;\r\n        spawnCount += rollForSpawns(defLaneSpawns);\r\n      }else{\r\n        curTicker++;\r\n      }\r\n    }\r\n  }\r\n\r\n  throttledUpdate();\r\n}\r\n\r\nexport const onThrottledUpdate = () => {\r\n  if(global.gameActive){\r\n    updateSpawnCount();\r\n    groups.enemies.children?.each(entity => {\r\n      entity.throttledUpdate();\r\n    });\r\n    \r\n    groups.player.children?.each(entity => {\r\n      entity.throttledUpdate();\r\n    });\r\n  }\r\n}\r\n\r\nconst throttledUpdate = throttle(THROTTLE_SPEED, false, onThrottledUpdate);\r\nexport const spawn = (group, key, anim, x, y) => {\r\n  // console.log(`spawn ${key} at (${x}, ${y})`)\r\n\r\n  let item = groups[group].create(x, y, key);\r\n  item.anims.play(anim);\r\n  return item;\r\n}\r\n\r\n/* Internal spawn methods */\r\nconst randomizeStats = statsObj => {\r\n  return {\r\n    speed: Phaser.Math.FloatBetween(statsObj.speed[0], statsObj.speed[1]),\r\n    jumpRate: Phaser.Math.FloatBetween(statsObj.jumpRate[0], statsObj.jumpRate[1]),\r\n  }\r\n}\r\n\r\nconst spawnIt = (EntityRef, entityData, laneIdx) => {\r\n  const pos = spawnPositions[laneIdx];\r\n  const stats = randomizeStats(entityData.stats);\r\n  \r\n  let entity = new EntityRef(sceneContext, groups.enemies, {\r\n    x: pos.x,\r\n    y: pos.y,\r\n    stats: stats,\r\n    depth: getDepthOfLane(laneIdx),\r\n    misc: entityData.misc,\r\n    type: entityData.type,\r\n    particleDeath: entityData.particleDeath\r\n  });\r\n  const randomScale = Phaser.Math.FloatBetween(entityData.scaleRange[0], entityData.scaleRange[1]) / 100;\r\n  entity.setScale(randomScale);\r\n}\r\n\r\nexport const spawnStatus = (type, x, y, depth) => {\r\n  let status = new Status.Entity(sceneContext, x, y, type, depth);\r\n};\r\n\r\nexport const spawnBowl = (x, y) => {\r\n  let bowl = new Bowl.Entity(sceneContext, groups.bowls, {\r\n    x: x,\r\n    y: y\r\n  });\r\n\r\n  bowl.setVelocity(defGlobalEntities.bowl.spawnSpeed, 20);\r\n}\r\n\r\nexport const slingBowl = () => {\r\n  let bowl = new Bowl.Entity(sceneContext, groups.bowls, {\r\n    x: player.x + 20,\r\n    y: player.y + 90,\r\n    depth: getDepthOfLane(player.laneIdx, 1)\r\n  });\r\n\r\n  bowl.setVelocity(defGlobalEntities.bowl.spawnSpeed, -100);\r\n  \r\n  playSound(SOUNDS.BOWL_SLING);\r\n}\r\n\r\nconst spawnPlayer = (laneData) => {\r\n  player = new Player.Entity(sceneContext, 800, 300, groups.player, laneData);\r\n}\r\n\r\nconst updateSpawnCount = () => {\r\n  const activeEnemies = groups.enemies.countActive();\r\n  if(lastSentActiveEnemies !== activeEnemies){\r\n    lastSentActiveEnemies = activeEnemies;\r\n    Events.emit('interface', 'setMetric', { 'key': 'activeEnemies', 'value': activeEnemies });\r\n  }\r\n}\r\n\r\nconst formatSliderValue = sliderPosition => {\r\n  var minPerc = 0;\r\n  var maxPerc = 100;\r\n\r\n  var minV = Math.log(SPAWN_MIN);\r\n  var maxV = Math.log(SPAWN_MAX);\r\n  \r\n  var scale = (maxV-minV) / (maxPerc-minPerc);\r\n  \r\n  return Math.round(Math.exp(minV + scale*(sliderPosition-minPerc)));\r\n}\r\n\r\n\r\n/*\r\n//- this approach seems to perform a lot better, however cannot extend gameobject class correctly\r\nconst basicSpawn = () => {\r\n  let enemy = enemies.create(0, 50, 'raccoon_walk');\r\n  // console.log('instance:', enemy)\r\n\r\n  //- physics\r\n  enemy.setBounce(.4);\r\n  enemy.setCollideWorldBounds(true);\r\n  enemy.allowGravity = false;\r\n  \r\n  //- squeeze in hit box from edge of sprite\r\n  enemy.body.setSize(60,70);\r\n  enemy.body.offset.x = 35;\r\n  enemy.body.offset.y = 30;\r\n  enemy.anims.play('raccoon_walk');\r\n\r\n  enemy.setVelocity(Phaser.Math.Between(200, 800), 20);\r\n}\r\n */\r\n\r\nexport const external_setSpawnFrequency = (newValue) => {\r\n  spawnFrequency = formatSliderValue(newValue);\r\n}\r\n\r\nconst exportMap = {\r\n  setContext,\r\n  preload,\r\n  create,\r\n  update,\r\n  spawn,\r\n  spawnBowl,\r\n  slingBowl,\r\n  external_setSpawnFrequency\r\n}\r\nexport default exportMap; ","// slightly evolving from create-react-app example\r\nimport { createSelector, createSlice, PayloadAction } from '@reduxjs/toolkit';\r\nimport { useSelector } from 'react-redux';\r\nimport { RootState } from '../store';\r\n\r\nexport interface StatsState {\r\n  gameStatus: 'active' | 'inactive',\r\n  playStatus: 'inactive' | 'playing' | 'won' | 'lost' | 'paused',\r\n  playStatusReason: string\r\n}\r\n\r\nconst initialState: StatsState = {\r\n  gameStatus: 'inactive',\r\n  playStatus: 'inactive',\r\n  playStatusReason: ''\r\n};\r\n\r\nexport const statusSlice = createSlice({\r\n  name: 'status',\r\n  initialState,\r\n  // The `reducers` field lets us define reducers and generate associated actions\r\n  reducers: {\r\n    startGame: state => {\r\n      state.gameStatus = 'active';\r\n      state.playStatus = 'playing';\r\n      state.playStatusReason = '';\r\n    },\r\n    exitGame: state => {\r\n      state.gameStatus = 'inactive';\r\n      state.playStatus = 'inactive';\r\n      state.playStatusReason = '';\r\n    },\r\n    winRound: (state, reason: PayloadAction<string>) => {\r\n      state.playStatus = 'won';\r\n      state.playStatusReason = reason.payload;\r\n    },\r\n    loseRound: (state, reason: PayloadAction<string>) => {\r\n      state.playStatus = 'lost';\r\n      state.playStatusReason = reason.payload;\r\n    }\r\n  }\r\n});\r\n\r\n\r\n\r\nexport const { startGame, exitGame, winRound, loseRound } = statusSlice.actions;\r\n\r\nexport const selectGameStatus = (state: RootState) => state.game.status.gameStatus;\r\nexport const selectPlayStatus = (state: RootState) => state.game.status.playStatus;\r\nexport const selectPlayStatusReason = (state: RootState) => state.game.status.playStatusReason;\r\n\r\nconst getModalFromGameStatus = createSelector(\r\n  [\r\n    selectGameStatus,\r\n    selectPlayStatus, \r\n    selectPlayStatusReason\r\n  ],\r\n  (gameStatus, playStatus, reason) => {\r\n    if(gameStatus === 'active'){\r\n      if(['paused', 'lost', 'won'].some(s => s === playStatus)){\r\n        return {\r\n          status: playStatus,\r\n          reason\r\n        } as PlayStatusObj\r\n      }\r\n    }\r\n\r\n    return null;    \r\n  }\r\n)\r\nexport const ReselectModalFromGameStatus = () => {\r\n  return useSelector(getModalFromGameStatus)\r\n}\r\n\r\nexport default statusSlice.reducer;","\r\nexport const Values = {\r\n  zindex:{\r\n    BACKGROUND: 0,\r\n    LANE_1: 10,\r\n    LANE_2: 20,\r\n    LANE_3: 30,\r\n    LANE_4: 40,\r\n    FOREGROUND: 50\r\n  }\r\n}\r\n\r\n\r\nexport const getDepthOfLane = (laneIdx, offset = 0) => {\r\n  try{\r\n    const idx = Values.zindex[`LANE_${laneIdx + 1}`] + offset;\r\n    if(!isNaN(idx)) return idx;\r\n  }catch(e){\r\n  }\r\n\r\n  return 0;\r\n}\r\n\r\nexport default Values;","// slightly evolving from create-react-app example\r\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\n\r\nimport { RootState } from '../store';\r\nimport { exitGame } from './status-slice';\r\n\r\n\r\nexport interface StatsState {\r\n  bowls: number,\r\n  hugs: number,\r\n  bites: number,\r\n  captures: number,\r\n  escapes: number,\r\n  activeEnemies: number\r\n}\r\n\r\nconst initialState: StatsState = {\r\n  bowls: 0,\r\n  hugs: 0,\r\n  bites: 0,\r\n  captures: 0,\r\n  escapes: 0,\r\n  activeEnemies: 0\r\n};\r\n\r\nconst scoreModifiers: GameMetrics = {\r\n  bowls: -.25,\r\n  hugs: 5,\r\n  bites: -10,\r\n  captures: 10,\r\n  escapes: -5,\r\n  activeEnemies: 0\r\n};\r\n\r\nexport const metricsSlice = createSlice({\r\n  name: 'metrics',\r\n  initialState,\r\n  // The `reducers` field lets us define reducers and generate associated actions\r\n  reducers: {\r\n    setMetric: (state: StatsState, action: PayloadAction<any>) => {\r\n      const key = action.payload?.key as GameMetricKey;\r\n      if(state[key] !== undefined){\r\n        state[key] = action.payload?.value;\r\n      }else{\r\n        console.error('invalid stat called in reducer:', action.payload.key)\r\n      }\r\n\r\n      // state.score = getScore(state);\r\n    }\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(exitGame, (state) => {\r\n        return initialState;\r\n      })\r\n  },\r\n});\r\n\r\nexport const getScore = (metrics: GameMetrics) => {\r\n  let total = 0;\r\n  Object.keys(metrics).forEach(k => {\r\n    // ignore 'score' or other unwanted values\r\n    if(scoreModifiers[k as GameMetricKey]){\r\n      total += metrics[k as GameMetricKey] * scoreModifiers[k as GameMetricKey];\r\n    }\r\n  })\r\n\r\n  return total;\r\n}\r\n\r\n\r\n\r\nexport const { setMetric } = metricsSlice.actions;\r\nexport const selectMetrics = (state: RootState): Array<GameMetric> => {\r\n  return Object.keys(state.game.metrics)\r\n  .filter(sKey => scoreModifiers[sKey as GameMetricKey] !== undefined)\r\n  .map(k => ({\r\n    key: k,\r\n    value: state.game.metrics[k as GameMetricKey],\r\n    isGood: scoreModifiers[k as GameMetricKey] > 0\r\n  }));\r\n};\r\n\r\nexport const selectMetricsMap = (state: RootState): GameMetrics => {\r\n  return state.game.metrics;\r\n};\r\n\r\nexport const selectGoodMetrics = (state: RootState) => {\r\n  return selectMetrics(state).filter(s => s.isGood);\r\n};\r\nexport const selectBadMetrics = (state: RootState) => {\r\n  return selectMetrics(state).filter(s => !s.isGood);\r\n};\r\nexport const selectScore = (state: RootState) => getScore(state.game.metrics);\r\nexport const selectActiveEnemies = (state: RootState) => state.game.metrics.activeEnemies;\r\nexport default metricsSlice.reducer;\r\n","import Phaser from 'phaser';\r\nimport { cancelSound, playSound, SOUNDS } from '../sound';\r\n\r\nconst KILL_TIMEOUT = 3000;\r\nconst DESTROY_TIMEOUT = 1000;\r\nconst PUNT_TIMEOUT = 1000;\r\nlet sceneRef;\r\n\r\nexport const STATUS = {\r\n  ROAMING: 0,\r\n  EATING: 1,\r\n  ROAMING_TAME: 3,\r\n  DEAD: 4,\r\n  HUGGING: 5,\r\n  IDLE: 6,\r\n  CAPTURED: 12,\r\n  ESCAPED: 13,\r\n  BITING: 14,\r\n}\r\n\r\nconst spriteKey = 'raccoon';\r\nconst velocityRanges = {\r\n  LIL_PUNT: {\r\n    min: { x: -75, y: -50 },\r\n    max: { x: -200, y: -200 },\r\n    diff: { x: 0, y: 0 }\r\n  },\r\n  BIG_PUNT: {\r\n    min: { x: -500, y: -300 },\r\n    max: { x: -700, y: -500 },\r\n    diff: { x: 0, y: 0 }\r\n  }\r\n}\r\n\r\nvelocityRanges.LIL_PUNT.diff = {\r\n  x: velocityRanges.LIL_PUNT.max.x - velocityRanges.LIL_PUNT.min.x,\r\n  y: velocityRanges.LIL_PUNT.max.y - velocityRanges.LIL_PUNT.min.y\r\n};\r\nvelocityRanges.BIG_PUNT.diff = {\r\n  x: velocityRanges.BIG_PUNT.max.x - velocityRanges.BIG_PUNT.min.x,\r\n  y: velocityRanges.BIG_PUNT.max.y - velocityRanges.BIG_PUNT.min.y\r\n};\r\n\r\n/*\r\nstats = {\r\n  speed: [ minSpeedX, maxSpeedX ]\r\n}\r\n*/\r\nclass Entity extends Phaser.Physics.Arcade.Sprite {\r\n  constructor (scene, physicsGroup, spawnData) {\r\n    super(scene, spawnData.x, spawnData.y, 'raccoon');\r\n    sceneRef = scene;\r\n    this.deathTimer = null;\r\n    this.destroyTimer = null;\r\n    this.punted = null;\r\n    this.type = 'raccoon';\r\n    this.particleDeath = spawnData.particleDeath;\r\n\r\n    this.eatingSound = null;\r\n\r\n    // this.status = STATUS.ROAMING;\r\n    // this.love = 0;\r\n    // this.maxLove = 100;\r\n    this.stats = spawnData.stats || {};\r\n    this.status = null;\r\n    this.isFull = false;\r\n\r\n    // move bowl to the right, relative to entity\r\n    this.eatOffset = 11;\r\n\r\n    this.curPhysState = null;\r\n    this.curAnimState = null;\r\n\r\n    this.puntKillThreshold = 1;\r\n    if(spawnData.misc?.puntKillThreshold || spawnData.misc?.puntKillThreshold === 0){\r\n      this.puntKillThreshold = spawnData.misc.puntKillThreshold;\r\n    }\r\n\r\n    this.feedable = true;\r\n    if(spawnData.misc?.feedable === false){\r\n      this.feedable = false;\r\n    }\r\n\r\n    //- parent stuff\r\n    if(!isNaN(spawnData.depth)) {\r\n      this.setDepth(spawnData.depth);\r\n    }\r\n    scene.add.existing(this);\r\n    if(physicsGroup){\r\n      physicsGroup.add(this);\r\n    }else{\r\n      scene.physics.add.existing(this);\r\n    }\r\n    \r\n    //- physics\r\n    this.setBounce(0);\r\n    this.setCollideWorldBounds(false);\r\n    this.allowGravity = false;\r\n\r\n    //- squeeze in hit box from edge of sprite\r\n    this.body.setSize(30,20);\r\n    this.body.offset.x = 15;\r\n    this.body.offset.y = 25;\r\n    this.setStatus(STATUS.ROAMING, true);\r\n\r\n    //- interaction listeners\r\n    this.setInteractive();\r\n    if(spawnData.misc?.tint){\r\n      this.setTint(spawnData.misc.tint);\r\n    }\r\n  }\r\n\r\n  clicked(){\r\n    this.kill(true);\r\n  }\r\n\r\n  canEat(){\r\n    if(this.isAlive() && this.feedable && !this.isFull){\r\n      switch(this.status){\r\n        case STATUS.EATING: return false;\r\n        default: return true;\r\n      }\r\n    }else{\r\n      return false;\r\n    }\r\n  }\r\n  \r\n  canIdle(){\r\n    if(this.isAlive() && this.body.touching.down && this.body.velocity.x === 0){\r\n      switch(this.status){\r\n        case STATUS.ROAMING: return true;\r\n        case STATUS.IDLE: return true;\r\n        default: return false;\r\n      }\r\n    }else{\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // right now, its a %, later should be actual power\r\n  punt(force){\r\n    this.punted = true;\r\n    this.puntedTimer = sceneRef.time.delayedCall(PUNT_TIMEOUT, () => {\r\n      this.punted = false;\r\n    });\r\n    \r\n    // console.log('force', force)\r\n    this.body.setDrag(0);\r\n\r\n    let vRange;\r\n    if(force < .5){\r\n      vRange = velocityRanges.LIL_PUNT;\r\n    }else{\r\n      vRange = velocityRanges.BIG_PUNT;\r\n    }\r\n\r\n    // console.log('vRange', vRange.min.x + vRange.diff.x * force)\r\n    this.setVelocity(\r\n      vRange.min.x + vRange.diff.x * force,\r\n      vRange.min.y + vRange.diff.y * force,\r\n    );\r\n  }\r\n\r\n  kill(quickKill){\r\n    this.setStatus(STATUS.DEAD);\r\n\r\n    if(quickKill){\r\n      this.destroy();\r\n    }\r\n    else{\r\n      this.deathTimer = sceneRef.time.delayedCall(KILL_TIMEOUT, () => {\r\n        this.destroy();\r\n      });\r\n    }\r\n  }\r\n\r\n  update(){\r\n    //- turn if facing left\r\n    if(this.isAlive() && this.flipX){\r\n      if(this.body.velocity.x >= 0) this.flipX = false;\r\n    }else{\r\n      if(this.body.velocity.x < 0) this.flipX = true;\r\n    }\r\n\r\n    const animKey = this.getAnimationForState();\r\n    if(animKey !== this.curAnim){\r\n      this.curAnim = animKey;\r\n      this.playAnimationForKey(animKey);\r\n    }\r\n    \r\n    this.adjustMovementForState();\r\n  }\r\n\r\n  isAlive(){\r\n    return this.status !== STATUS.DEAD;\r\n  }\r\n\r\n  isMovingStatus(given){\r\n    switch (given || this.status){\r\n      case STATUS.ROAMING: return true;\r\n      case STATUS.ROAMING_TAME: return true;\r\n      default: break;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  adjustMovementForState(){\r\n    if(this.body.velocity.x < 1 && this.body.velocity.x > -1){\r\n      //- if still, but in a moving status (most likely after falling), force it again to get movin!\r\n      if(this.isMovingStatus(this.status)){\r\n        this.setStatus(this.status, true);\r\n      };\r\n    }\r\n\r\n    //- attempt to readjust after landing from a punt\r\n    if(this.body.touching.down && this.body.velocity.x < 0){\r\n      this.moveStop();\r\n    }\r\n  }\r\n\r\n  getAnimationForState(){\r\n    if(this.status === STATUS.DEAD){\r\n      return 'raccoon_dead';\r\n    } else {\r\n      if (this.body.velocity.y < -50) {\r\n        return 'raccoon_hop_up';\r\n      } else if (this.body.velocity.y > 50) {\r\n        return 'raccoon_hop_down';\r\n      } else if (this.status === STATUS.EATING){\r\n        return 'raccoon_eat';\r\n      } else if (this.status === STATUS.ROAMING_TAME){\r\n        return 'raccoon_loveWalk';\r\n      } else if (this.status === STATUS.ROAMING){\r\n        return 'raccoon_angryWalk';\r\n      } else if (this.status === STATUS.HUGGING){\r\n        return 'raccoon_hug';\r\n      } else if (this.status === STATUS.BITING){\r\n        return 'raccoon_bite';\r\n      } else if (this.status === STATUS.ESCAPED){\r\n        return 'raccoon_bite';\r\n      } else if (this.status === STATUS.CAPTURED){\r\n        return 'raccoon_hug';\r\n      } \r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  setPhysState(){\r\n    const physState = null;\r\n\r\n\r\n    if(physState && physState !== this.curPhysState){\r\n\r\n    }\r\n  }\r\n\r\n  throttledUpdate(){\r\n\r\n  }\r\n  \r\n  eatAtBowl(bowlBody){\r\n    // align with the food bowl\r\n    this.body.x = bowlBody.x - this.eatOffset;\r\n    const detune = Phaser.Math.Between(-800, 800);\r\n    const eatRate = Phaser.Math.FloatBetween(0.8, 1.2);\r\n    this.eatingSound = playSound(SOUNDS.ENEMY_EATING, { \r\n      volume: 0.3, \r\n      detune: detune,\r\n      rate: eatRate\r\n    });\r\n\r\n    this.setStatus(STATUS.EATING);\r\n  }\r\n\r\n  bowlEmpty(){\r\n    cancelSound(this.eatingSound);\r\n    if(this.isAlive()){\r\n      this.isFull = true;\r\n      this.setStatus(STATUS.ROAMING_TAME);\r\n    }\r\n  }\r\n\r\n  playAnimationForKey(animKey){\r\n    if(animKey){\r\n      this.anims.play(animKey);\r\n    }\r\n  }\r\n\r\n  checkStatus(statusKey){\r\n    return this.status === statusKey;\r\n  }\r\n\r\n  moveNormal(modifier = 1){\r\n    this.body.setDrag(0);\r\n    // this.body.velocity.x = 10; \r\n    this.body.velocity.x = this.stats.speed * modifier;\r\n  }\r\n\r\n  moveStop(){\r\n    this.body.setDrag(500);\r\n  }\r\n\r\n\r\n  setStatus(status, force, playStatusAnimation = true){\r\n    if(force || this.status !== status){\r\n      this.status = status;\r\n\r\n      switch(this.status){\r\n        case STATUS.ROAMING: \r\n          this.moveNormal();\r\n          break;\r\n        case STATUS.ROAMING_TAME: \r\n          this.moveNormal(3);\r\n          break;\r\n        case STATUS.EATING: \r\n          this.moveStop();\r\n          break;\r\n        case STATUS.DEAD:\r\n          this.moveStop();\r\n          break;\r\n        case STATUS.HUGGING: \r\n          this.moveStop();\r\n          break;\r\n        case STATUS.BITING: \r\n          this.moveStop();\r\n          break;\r\n        case STATUS.CAPTURED: \r\n          this.moveStop();\r\n          break;\r\n        case STATUS.ESCAPED: \r\n          this.moveStop();\r\n          break;\r\n        default: break;\r\n      }\r\n    }\r\n  }\r\n\r\n  // assumeStatus(){\r\n  //   if(this.isAlive()){\r\n  //     if(this.isFull){\r\n  //       return STATUS.ROAMING_TAME;\r\n  //     }else{\r\n  //       if(this.canIdle()){\r\n  //         return STATUS.IDLE;\r\n  //       }else{\r\n  //         return STATUS.ROAMING;\r\n  //       }\r\n  //     }\r\n  //   }\r\n  // }\r\n\r\n  resumeStatus(){\r\n    const statusKey = this.resumeStatus;\r\n    this.setStatus(statusKey)\r\n  }\r\n\r\n  escaped(){\r\n    this.setStatus(STATUS.ESCAPED);\r\n    this.delayedDestroy();\r\n  }\r\n\r\n  captured(){\r\n    this.setStatus(STATUS.CAPTURED);\r\n    this.delayedDestroy();\r\n  }\r\n  \r\n  hug(){    \r\n    this.setStatus(STATUS.HUGGING);\r\n    this.delayedDestroy();\r\n  }\r\n  \r\n  bite(){\r\n    this.setStatus(STATUS.BITING);\r\n    this.delayedDestroy();\r\n  }\r\n\r\n  delayedDestroy(){\r\n    this.destroyTimer = sceneRef.time.delayedCall(DESTROY_TIMEOUT, () => {\r\n      this.destroy();\r\n    });\r\n  }\r\n}\r\n\r\nconst initSprites = (sceneContext) => {\r\n  \r\n  sceneContext.anims.create({\r\n    key: 'raccoon_idle',\r\n    frames: [ \r\n      { key: spriteKey, frame: 0 },  \r\n      { key: spriteKey, frame: 1 } \r\n    ],\r\n    frameRate: 7,\r\n    repeat: -1\r\n  });\r\n\r\n  sceneContext.anims.create({\r\n    key: 'raccoon_walk',\r\n    frames: [ \r\n      { key: spriteKey, frame: 2 },  \r\n      { key: spriteKey, frame: 3 } \r\n    ],\r\n    frameRate: 7,\r\n    repeat: -1\r\n  });\r\n\r\n  sceneContext.anims.create({\r\n    key: 'raccoon_hop_start',\r\n    frames: [ { key: spriteKey, frame: 4 } ],\r\n    frameRate: 7,\r\n    repeat: 0\r\n  });\r\n\r\n  sceneContext.anims.create({\r\n    key: 'raccoon_hop_up',\r\n    frames: [ { key: spriteKey, frame: 5 } ],\r\n    frameRate: 7,\r\n    repeat: 0\r\n  });\r\n  \r\n  sceneContext.anims.create({\r\n    key: 'raccoon_hop_down',\r\n    frames: [ { key: spriteKey, frame: 6 } ],\r\n    frameRate: 7,\r\n    repeat: 0\r\n  });\r\n\r\n  sceneContext.anims.create({\r\n    key: 'raccoon_hop_end',\r\n    frames: [ { key: spriteKey, frame: 7 } ],\r\n    frameRate: 7,\r\n    repeat: 0\r\n  });\r\n  \r\n  sceneContext.anims.create({\r\n    key: 'raccoon_angryWalk',\r\n    frames: sceneContext.anims.generateFrameNumbers(spriteKey, { start: 2, end: 3 }),\r\n    frameRate: 7,\r\n    repeat: -1\r\n  });\r\n\r\n  sceneContext.anims.create({\r\n    key: 'raccoon_loveWalk',\r\n    frames: sceneContext.anims.generateFrameNumbers(spriteKey, { start: 10, end: 11 }),\r\n    frameRate: 7,\r\n    repeat: -1\r\n  });\r\n\r\n  sceneContext.anims.create({\r\n    key: 'raccoon_dead',\r\n    frames: sceneContext.anims.generateFrameNumbers(spriteKey, { start: 16, end: 17 }),\r\n    frameRate: 7,\r\n    repeat: -1\r\n  });\r\n\r\n  sceneContext.anims.create({\r\n    key: 'raccoon_eat',\r\n    frames: sceneContext.anims.generateFrameNumbers(spriteKey, { start: 8, end: 9 }),\r\n    frameRate: 7,\r\n    repeat: -1\r\n  });\r\n\r\n  sceneContext.anims.create({\r\n    key: 'raccoon_hug',\r\n    frames: sceneContext.anims.generateFrameNumbers(spriteKey, { start: 12, end: 13 }),\r\n    frameRate: 7,\r\n    repeat: -1\r\n  });\r\n\r\n  sceneContext.anims.create({\r\n    key: 'raccoon_bite',\r\n    frames: sceneContext.anims.generateFrameNumbers(spriteKey, { start: 14, end: 15 }),\r\n    frameRate: 7,\r\n    repeat: -1\r\n  });\r\n\r\n  sceneContext.anims.create({\r\n    key: 'raccoon_punted',\r\n    frames: sceneContext.anims.generateFrameNumbers(spriteKey, { start: 2, end: 3 }),\r\n    frameRate: 7,\r\n    repeat: -1\r\n  });\r\n}\r\n\r\nconst initSpritesheet = (sceneContext) => {\r\n  sceneContext.load.spritesheet('raccoon', './assets/sprites/raccoon2.png', { frameWidth: 56, frameHeight: 56 });\r\n}\r\n\r\nconst exportMap = {\r\n  Entity,\r\n  initSprites,\r\n  initSpritesheet,\r\n}\r\nexport default exportMap; ","import Phaser from 'phaser';\r\nimport { playSound, cancelSound, SOUNDS } from '../sound';\r\nimport { getDepthOfLane } from '../utils/values';\r\nimport StatBar from './stat-bar';\r\n\r\nconst STARTING_LANE = 2;\r\nconst KICK_DURATION = 500; // becomes variable based on kick power\r\nconst ATTACKED_DURATION = 1000;\r\nconst DESTROY_TIMEOUT = 5000;\r\nconst MIN_KICK_FORCE = .3;\r\nconst KICK_CHARGE_SPEED = .07;\r\nlet statBar;\r\nlet sceneRef;\r\n\r\nexport const STATUS = {\r\n  IDLE: 0,\r\n  FEED: 1,\r\n  HUGGING: 2,\r\n  KICK_PREP: 3,\r\n  KICK: 4,\r\n  ATTACKED: 5,\r\n  DEAD: 6\r\n}\r\n\r\nconst animationStatus = {\r\n  [STATUS.IDLE]: 'player_idle',\r\n  [STATUS.FEED]: 'player_idle',\r\n  [STATUS.HUGGING]: 'player_hug',\r\n  [STATUS.KICK_PREP]: 'player_kick_prep',\r\n  [STATUS.KICK]: 'player_kick',\r\n  [STATUS.ATTACKED]: 'player_hurt',\r\n  [STATUS.DEAD]: 'player_idle'\r\n}\r\n\r\nconst gameState = {};\r\n\r\nclass Entity extends Phaser.Physics.Arcade.Sprite {\r\n  constructor (scene, x, y, physicsGroup, laneData) {\r\n    super(scene, x, y, 'player');\r\n    sceneRef = scene;\r\n    this.recoveryTimer = null;\r\n    this.destroyTimer = null;\r\n\r\n    this.hpRange = [ 0, 100 ];\r\n    this.hp = this.hpRange[1];\r\n    this.laneIdx = 0;\r\n    this.laneValues = this.parseLaneData(laneData);\r\n    this.posOffset = [];\r\n    this.spriteOffset = [];\r\n    this.lastIntent = null;\r\n    this.chargeSound = null;\r\n\r\n    this.isAlive = true;\r\n    this.kickCharge = 0;\r\n\r\n    //- parent stuff\r\n    scene.add.existing(this);\r\n    if(physicsGroup){\r\n      physicsGroup.add(this);\r\n    }else{\r\n      scene.physics.add.existing(this);\r\n    }\r\n\r\n    /* tweak settings here when sprite changes size */\r\n    this.setOrigin(0, 0).refreshBody();\r\n    // this.body.setSize(50, 75);\r\n    // this.posOffset = [ 0, 20 ];\r\n    /* normal phaser way isnt working, so pass this along to offset the sprite a lil */\r\n    // this.spriteOffset = [ 12, 6 ];\r\n\r\n    this.body.setSize(60, 100);\r\n    this.posOffset = [ -120, 4 ];\r\n    this.spriteOffset = [ 12, 6 ];\r\n    this.setScale(1.3);\r\n\r\n    this.updatePlayerPosition();\r\n    this.setStatus(STATUS.IDLE, true);\r\n    \r\n    gameState.cursors = scene.input.keyboard.createCursorKeys();\r\n    \r\n    statBar = new StatBar.Entity(scene, 150, 150);\r\n    this.changeLane(STARTING_LANE);\r\n  }\r\n\r\n  setLaneDepth(){\r\n    this.setDepth(getDepthOfLane(this.laneIdx) - 1);\r\n  }\r\n\r\n  parseLaneData(laneData){\r\n    return laneData.map(lane => ({\r\n      x: parseInt(lane.x) + parseInt(lane.width) - 10,\r\n      y: parseInt(lane.y) - 110\r\n    }));\r\n  }\r\n  \r\n  changeLane(diff){\r\n    this.laneIdx += diff;\r\n    const maxIdx = this.laneValues.length - 1;\r\n    if(this.laneIdx > maxIdx){\r\n      this.laneIdx = 0;\r\n    }else if(this.laneIdx < 0){\r\n      this.laneIdx = maxIdx;\r\n    }\r\n\r\n    playSound(SOUNDS.CHANGE_LANE);\r\n\r\n    this.updatePlayerPosition();\r\n  }\r\n\r\n  updatePlayerPosition(){\r\n    const pos = this.laneValues[this.laneIdx];\r\n    const realPos = {\r\n      x: pos.x + this.posOffset[0],\r\n      y: pos.y + this.posOffset[1],\r\n    }\r\n    this.body.x = realPos.x + this.spriteOffset[0];\r\n    this.body.y = realPos.y + this.spriteOffset[1];\r\n    this.setPosition(realPos.x, realPos.y);\r\n    statBar && statBar.setOffsetPosition(realPos.x, realPos.y);\r\n\r\n    // OK to cancel a kick animation, not OK to cancel a charge\r\n    if(this.status === STATUS.KICK){\r\n      this.cancelKick();\r\n    }\r\n    \r\n    this.setLaneDepth();\r\n  }\r\n\r\n  checkStatus(statusKey){\r\n    // console.log('check', statusKey, this.status, STATUS[statusKey])\r\n    return this.status === statusKey;\r\n  }\r\n  checkStatuses(statusKeys){\r\n    return statusKeys.indexOf(this.status) > -1;\r\n  }\r\n  \r\n  onAttackedByEnemy(enemy){\r\n    // console.log('hurt')\r\n    this.setStatus(STATUS.ATTACKED);\r\n    this.recoveryTimer = sceneRef.time.delayedCall(ATTACKED_DURATION, () => {\r\n      this.setStatus(STATUS.IDLE);\r\n    });\r\n  }\r\n  \r\n  kill(){\r\n    this.setStatus(STATUS.DEAD);\r\n    this.delayedDestroy();\r\n  }\r\n\r\n  delayedDestroy(){\r\n    this.destroyTimer = sceneRef.time.delayedCall(DESTROY_TIMEOUT, () => {\r\n      this.destroy();\r\n    });\r\n  }\r\n\r\n  chargeKick(){\r\n    this.kickCharge += KICK_CHARGE_SPEED;\r\n    if(this.kickCharge > 1){\r\n      this.kickCharge = 1;\r\n    }\r\n\r\n    statBar.setProgress(this.kickCharge);\r\n  }\r\n\r\n  startKick(){\r\n    if(!this.checkStatuses([STATUS.KICK, STATUS.KICK_PREP])){\r\n      \r\n      this.chargeSound = playSound(SOUNDS.CHARGE);\r\n      this.setStatus(STATUS.KICK_PREP);\r\n    }\r\n  }\r\n\r\n  // helps to give a minimum kick strength, helps for tapping kick and not getting 0 strength\r\n  // normalizes 0-1 between [ MIN_KICK_FORCE, 1 ]\r\n  getModifiedKickCharge(){\r\n    return MIN_KICK_FORCE + (this.kickCharge * (1 - MIN_KICK_FORCE));\r\n  }\r\n\r\n  kick(){\r\n    this.setStatus(STATUS.KICK);\r\n    cancelSound(this.chargeSound);\r\n    playSound(SOUNDS.ENEMY_BITE);\r\n\r\n    this.recoveryTimer = sceneRef.time.delayedCall(this.getModifiedKickCharge() * KICK_DURATION, () => {\r\n      this.cancelKick();\r\n    });\r\n  }\r\n\r\n  cancelKick(){\r\n    // TODO_SOUND\r\n    this.kickCharge = 0;\r\n    statBar.setProgress(this.kickCharge);\r\n    this.setStatus(STATUS.IDLE);\r\n  }\r\n\r\n  //- eventually this should be % charge * stats\r\n  getKickStrength(){\r\n    return this.getModifiedKickCharge();\r\n  }\r\n\r\n\r\n  startHug(){\r\n    if(!this.checkStatus(STATUS.HUGGING)){\r\n      playSound(SOUNDS.PLAYER_HUG);\r\n      this.setStatus(STATUS.HUGGING);\r\n    }\r\n  }\r\n  cancelHug(){\r\n    if(this.checkStatus(STATUS.HUGGING)){\r\n      this.setStatus(STATUS.IDLE);\r\n    }\r\n  }\r\n\r\n\r\n  onHugEnemy(enemy){\r\n    // if(this.isAlive){\r\n      // this.setStatus(STATUS.HUG);\r\n      \r\n      // this.startRecoveryTimer(() => {\r\n      //   this.setStatus(STATUS.IDLE);\r\n      // }, 500);\r\n    // }\r\n  }\r\n\r\n  update(){\r\n    const intent = this.getIntentFromStateAndKeys();\r\n    if(intent !== this.lastIntent){\r\n      this.lastIntent = intent;\r\n      switch(intent){\r\n        case 'attacked': break; //too bad, youre being attacked\r\n        case 'moveUp': this.changeLane(-1); break;\r\n        case 'moveDown': this.changeLane(1); break;\r\n        case 'startKick': this.startKick(); break;\r\n        case 'releaseKick': this.kick(); break;\r\n        case 'startHug': this.startHug(); break;\r\n        case 'cancelHug': this.cancelHug(); break;\r\n        default: break;\r\n      }\r\n    }\r\n  }\r\n\r\n  getIntentFromStateAndKeys(){\r\n    if(this.isAlive){\r\n      if(this.checkStatus(STATUS.ATTACKED)){\r\n        return 'attacked';\r\n      }\r\n      // moving up and down cancel most other events\r\n      if(gameState.cursors.up.isDown){\r\n        return 'moveUp';\r\n      }\r\n      if(gameState.cursors.down.isDown){\r\n        return 'moveDown';\r\n      }\r\n\r\n\r\n      // if chargin a kick, see if you let it go\r\n      if(this.checkStatus(STATUS.KICK_PREP)){\r\n        if(!gameState.cursors.right.isDown){\r\n          return 'releaseKick';\r\n        }\r\n      } else if(gameState.cursors.right.isDown){\r\n        return 'startKick';\r\n      }\r\n\r\n      // now hugggs\r\n      if(this.checkStatus(STATUS.HUGGING)){\r\n        if(!gameState.cursors.left.isDown){\r\n          return 'cancelHug';\r\n        }\r\n      } else if(gameState.cursors.left.isDown){\r\n        return 'startHug';\r\n      }\r\n\r\n      // no other keys mattered so..?\r\n    }\r\n    return null;\r\n  }\r\n  \r\n  throttledUpdate(){\r\n    if(this.checkStatus(STATUS.KICK_PREP)){\r\n      this.chargeKick();\r\n    }\r\n  }\r\n\r\n\r\n  playAnimationForStatus(){\r\n    const animKey = animationStatus[this.status];\r\n    if(animKey){\r\n      this.anims.play(animKey);\r\n    }\r\n  }\r\n\r\n  setStatus(status, force, playStatusAnimation = true){\r\n    // console.log('setStatus', status);\r\n    if(force || this.status !== status){\r\n      if(this.status === STATUS.ATTACKED){\r\n        //- youre not attacked anymore, reset tint\r\n        this.setTint(0xffffff);\r\n      }\r\n      this.status = status;\r\n\r\n      switch(this.status){\r\n        case STATUS.IDLE: \r\n          break;\r\n        case STATUS.FEED: \r\n          break;\r\n        case STATUS.KICK_PREP: \r\n          break;\r\n        case STATUS.KICK: \r\n          break;\r\n        case STATUS.ATTACKED: \r\n          this.setTint(0xff0000);\r\n          break;\r\n        case STATUS.DEAD: \r\n          this.isAlive = false;\r\n          break;\r\n        default: break;\r\n      }\r\n      // console.log('status:', this.status)\r\n      const animKey = animationStatus[this.status];\r\n      if(animKey){\r\n        // console.log('animKey:', animKey)\r\n        this.anims.play(animKey);\r\n      }\r\n\r\n      if(playStatusAnimation) this.playAnimationForStatus();\r\n    }\r\n  }\r\n}\r\n\r\nconst initSprites = (sceneContext) => {\r\n  sceneContext.anims.create({\r\n    key: 'player_idle',\r\n    frames: sceneContext.anims.generateFrameNumbers('player', { start: 0, end: 1 }),\r\n    frameRate: 5,\r\n    repeat: -1\r\n  });\r\n  sceneContext.anims.create({\r\n    key: 'player_hug',\r\n    frames: [ { key: 'player', frame: 2 }, { key: 'player', frame: 3 } ],\r\n    frameRate: 4,\r\n    repeat: -1\r\n  });\r\n  sceneContext.anims.create({\r\n    key: 'player_kick_prep',\r\n    frames: [ { key: 'player', frame: 6 } ],\r\n    frameRate: 5,\r\n    repeat: 0\r\n  });\r\n  sceneContext.anims.create({\r\n    key: 'player_kick',\r\n    frames: [ { key: 'player', frame: 7 } ],\r\n    frameRate: 5,\r\n    repeat: -1\r\n  });\r\n  sceneContext.anims.create({\r\n    key: 'player_hurt',\r\n    frames: sceneContext.anims.generateFrameNumbers('player', { start: 4, end: 5 }),\r\n    frameRate: 5,\r\n    repeat: -1\r\n  });\r\n\r\n  \r\n  StatBar.initSprites(sceneContext);\r\n}\r\n\r\nconst initSpritesheet = (sceneContext) => {\r\n  sceneContext.load.spritesheet('player', './assets/entity-oldlady.png', { frameWidth: 64, frameHeight: 88 });\r\n\r\n  StatBar.initSpritesheet(sceneContext);\r\n}\r\n\r\nconst exportMap = {\r\n  Entity,\r\n  initSprites,\r\n  initSpritesheet,\r\n}\r\nexport default exportMap; ","import Phaser from 'phaser';\r\n\r\nconst NUM_CELLS = 7;\r\n\r\nconst OFFSET = {\r\n  x: 30,\r\n  y: -10\r\n};\r\n\r\nclass Entity extends Phaser.Physics.Arcade.Sprite {\r\n  constructor (scene, x, y) {\r\n    super(scene, x, y, 'statBar');\r\n\r\n    this.progress = 0;\r\n    scene.add.existing(this);\r\n  }\r\n\r\n  update(){\r\n  }\r\n\r\n  setOffsetPosition(x, y){\r\n    this.setPosition(x + OFFSET.x, y + OFFSET.y);\r\n  }\r\n\r\n  playAnimationForProgress(){\r\n    const cellIdx = Math.floor(NUM_CELLS * this.progress);\r\n    this.anims.play(`statBar_${cellIdx}`);\r\n  }\r\n\r\n  setProgress(progress, force){\r\n    // console.log('setStatus', status);\r\n    if(force || this.progress !== progress){\r\n      this.progress = progress;\r\n\r\n      const cellIdx = Math.floor(7 * this.progress);\r\n      this.anims.play(`statBar_${cellIdx}`);\r\n    }\r\n  }\r\n}\r\n\r\nconst initSprites = (sceneContext) => {\r\n  sceneContext.anims.create({\r\n    key: 'statBar_0',\r\n    frames: [ { key: 'statBar', frame: 0 } ],\r\n    frameRate: 0,\r\n    repeat: -1\r\n  });\r\n  \r\n  sceneContext.anims.create({\r\n    key: 'statBar_1',\r\n    frames: [ { key: 'statBar', frame: 1 } ],\r\n    frameRate: 0,\r\n    repeat: -1\r\n  });\r\n  \r\n  sceneContext.anims.create({\r\n    key: 'statBar_2',\r\n    frames: [ { key: 'statBar', frame: 2 } ],\r\n    frameRate: 0,\r\n    repeat: -1\r\n  });\r\n  \r\n  sceneContext.anims.create({\r\n    key: 'statBar_3',\r\n    frames: [ { key: 'statBar', frame: 3 } ],\r\n    frameRate: 0,\r\n    repeat: -1\r\n  });\r\n  \r\n  sceneContext.anims.create({\r\n    key: 'statBar_4',\r\n    frames: [ { key: 'statBar', frame: 4 } ],\r\n    frameRate: 0,\r\n    repeat: -1\r\n  });\r\n  sceneContext.anims.create({\r\n    key: 'statBar_5',\r\n    frames: [ { key: 'statBar', frame: 5 } ],\r\n    frameRate: 0,\r\n    repeat: -1\r\n  });\r\n  sceneContext.anims.create({\r\n    key: 'statBar_6',\r\n    frames: [ { key: 'statBar', frame: 6 } ],\r\n    frameRate: 0,\r\n    repeat: -1\r\n  });\r\n  sceneContext.anims.create({\r\n    key: 'statBar_7',\r\n    frames: [ { key: 'statBar', frame: 7 } ],\r\n    frameRate: 0,\r\n    repeat: -1\r\n  });\r\n  sceneContext.anims.create({\r\n    key: 'statBar_8',\r\n    frames: [ { key: 'statBar', frame: 8 } ],\r\n    frameRate: 0,\r\n    repeat: -1\r\n  });\r\n}\r\n\r\nconst initSpritesheet = (sceneContext) => {\r\n  sceneContext.load.spritesheet('statBar', './assets/statbar.png', { frameWidth: 45, frameHeight: 10 } )\r\n}\r\n\r\nconst exportMap = {\r\n  Entity,\r\n  initSprites,\r\n  initSpritesheet,\r\n}\r\nexport default exportMap; ","import Phaser from 'phaser'\r\nconst eventEmitter = new Phaser.Events.EventEmitter()\r\nexport default eventEmitter","import Phaser from \"phaser\";\r\nimport { spawnStatus } from \"../spawn\";\r\n\r\nconst DESTROY_TIMEOUT = 1000;\r\nconst DRAIN_TIMER_INTERVAL = 500;\r\nconst MAX_FEEDING = 1;\r\nlet sceneRef;\r\n\r\nexport const STATUS = {\r\n  FULL: 0,\r\n  EATING: 1,\r\n  EMPTY: 2\r\n}\r\n\r\nconst animationStatus = {\r\n  [STATUS.FULL]: 'foodBowl_full',\r\n  [STATUS.EATING]: 'foodBowl_full',\r\n  [STATUS.EMPTY]: 'foodBowl_empty'\r\n}\r\n\r\nclass Entity extends Phaser.Physics.Arcade.Sprite {\r\n    constructor (scene, physicsGroup, spawnData) {\r\n    super(scene, spawnData.x, spawnData.y, 'foodBowl');\r\n    sceneRef = scene;\r\n\r\n    this.drainRate = 0;\r\n    this.drainStart = null;\r\n    this.drainTimer = null;\r\n    this.destroyTimer = null;\r\n\r\n    this.hpRange = [ 0, 50 ];\r\n    this.hp = this.hpRange[1];\r\n\r\n    this.feeding = [];\r\n    this.canBeEaten = true;\r\n\r\n    //- parent stuff\r\n    scene.add.existing(this);\r\n    if(!isNaN(spawnData.depth)) {\r\n      this.setDepth(spawnData.depth);\r\n    }\r\n    if(physicsGroup){\r\n      physicsGroup.add(this);\r\n    }else{\r\n      scene.physics.add.existing(this);\r\n    }\r\n\r\n    //- physics\r\n    this.setBounce(.4);\r\n    this.setCollideWorldBounds(true);\r\n    // this.allowGravity = false;\r\n    \r\n    this.body.setSize(36,15);\r\n    this.body.offset.y = -2;\r\n\r\n    this.setStatus(STATUS.FULL, true);\r\n  }\r\n\r\n  addToDrainRate(drainRate){\r\n    this.drainRate += drainRate;\r\n    // console.log(`addToDrainRate to ${this.drainRate}`);\r\n\r\n    this.startDrainTimer();\r\n  }\r\n\r\n  setDrainRate(drainRate){\r\n    console.log(`setDrainRate to ${this.drainRate}`);\r\n    this.drainRate = drainRate;\r\n\r\n    this.startDrainTimer();\r\n  }\r\n\r\n  startDrainTimer(){\r\n    this.drainTimer = sceneRef.time.delayedCall(DRAIN_TIMER_INTERVAL, () => {\r\n      this.onDrainTimer();\r\n    });\r\n\r\n    this.drainStart = new Date();\r\n  }\r\n\r\n  onDrainTimer(){\r\n    const secondsSinceDrainStart = (new Date() - this.drainStart) / 1000;\r\n    const drainAmount = secondsSinceDrainStart * this.drainRate;\r\n    this.hp = this.hp - drainAmount;\r\n    // console.log(`hp: ${this.hp}, drainRate: ${this.drainRate}, drainAmount: ${drainAmount}`);\r\n    if(this.hp <= this.hpRange[0]){\r\n      this.hp = this.hpRange[0];\r\n      this.emptyBowl();\r\n    }else{\r\n      if(this.hp > this.hpRange[1]){\r\n        this.hp = this.hpRange[1];\r\n      }\r\n      this.startDrainTimer();\r\n    }\r\n  }\r\n\r\n  emptyBowl(){\r\n    this.setStatus(STATUS.EMPTY);\r\n    this.destroyTimer = sceneRef.time.delayedCall(DESTROY_TIMEOUT, () => {\r\n      this.destroy();\r\n    });\r\n  }\r\n\r\n  eatenBy(enemyEntity){\r\n    if(this.feeding.indexOf(enemyEntity) === -1){\r\n      enemyEntity.body.velocity.x = 0;\r\n      //- new feeder\r\n      this.addToDrainRate(20);\r\n      this.feeding.push(enemyEntity);\r\n      if(this.feeding.length >= MAX_FEEDING){\r\n        this.canBeEaten = false;\r\n      }\r\n    }else{\r\n      // console.log('feeding with ', this.feeding.length);\r\n    }\r\n\r\n    if(this.status === STATUS.FULL){\r\n      this.setStatus(STATUS.EATING);\r\n    }\r\n  }\r\n\r\n  update(){\r\n  }\r\n\r\n  setStatus(status, force){\r\n    if(force || this.status !== status){\r\n      this.status = status;\r\n\r\n      switch(this.status){\r\n        case STATUS.FULL: \r\n          break;\r\n        case STATUS.EATING: \r\n          this.body.velocity.x = 0;\r\n          this.body.setDrag(500);\r\n\r\n          break;\r\n        case STATUS.EMPTY: \r\n          this.canBeEaten = false;\r\n          this.feeding.forEach(feeder => {\r\n            spawnStatus('tame', feeder.body.x, feeder.body.y, feeder.depth);\r\n            feeder.bowlEmpty();\r\n          })\r\n          break;\r\n        default:;\r\n      }\r\n      const animKey = animationStatus[this.status];\r\n      if(animKey){\r\n        // console.log('play', animKey);\r\n        this.anims.play(animKey);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst initSprites = (sceneContext) => {\r\n  sceneContext.anims.create({\r\n    key: 'foodBowl_full',\r\n    frames: [ { key: 'foodBowl', frame: 0 } ],\r\n    frameRate: 10\r\n  });\r\n\r\n  sceneContext.anims.create({\r\n    key: 'foodBowl_empty',\r\n    frames: [ { key: 'foodBowl', frame: 1 } ],\r\n    frameRate: 10\r\n  });\r\n}\r\n\r\n\r\nconst initSpritesheet = (sceneContext) => {\r\n  sceneContext.load.spritesheet('foodBowl', './assets/bowl.png', { frameWidth: 38, frameHeight: 22 });\r\n}\r\n\r\nconst exportMap = {\r\n  Entity,\r\n  initSprites,\r\n  initSpritesheet\r\n}\r\nexport default exportMap; ","import Phaser, { Sound } from 'phaser';\r\n\r\nimport gameData from './data.json';\r\nimport { STATUS as STATUS_ENEMY } from './entities/raccoon';\r\nimport { STATUS as STATUS_PLAYER } from './entities/player';\r\nimport Events from '../event-emitter';\r\nimport SpawnController, { spawnStatus } from './spawn.js';\r\nimport LevelController from './level.js';\r\nimport { playSound, preload as preloadSound, init as initSound, SOUNDS } from './sound';\r\n\r\nlet game;\r\nlet levelGroups;\r\nlet sceneContext;\r\n\r\nconst INITIAL_STATE_POINTS = {\r\n  bowls: 0,\r\n  hugs: 0,\r\n  bites: 0,\r\n  captures: 0,\r\n  escapes: 0 \r\n}\r\nlet points = {};\r\n\r\nglobal.gameData = {\r\n  curLevel: 0\r\n}\r\n\r\nconst particleDefs = {\r\n  blood: {\r\n    image:'./assets/blood.png',\r\n    emitter:{\r\n      quantity: 20,\r\n      visible: false,\r\n      blendMode: 'SCREEN',\r\n      speed: { min: -400, max: 400 },\r\n      angle: { min: 210, max: 330 },\r\n      scale: { start: 1, end: 0 },\r\n      lifespan: 500,\r\n      gravityY: 1000\r\n    }\r\n  },\r\n  raccoon: {\r\n    atlas:'./assets/sprites/particle-raccoon',\r\n    sound: 'splat1',\r\n    emitter:{\r\n      quantity: 7,\r\n      frame: { frames: [ 'particle-raccoon0', 'particle-raccoon1', 'particle-raccoon2', 'particle-raccoon3', 'particle-raccoon4', 'particle-raccoon5', 'particle-raccoon6' ], cycle: true },\r\n      frequency:1,\r\n      visible: false,\r\n      speed: { min: 400, max: 600 },\r\n      angle: { min: 210, max: 330 },\r\n      scale: { start: 1.5, end: 2 },\r\n      lifespan: { min: 400, max: 800 },\r\n      gravityY: 2000\r\n    }\r\n  },\r\n  raccoon_mean: {\r\n    atlas:'./assets/sprites/particle-raccoon',\r\n    sound: 'splat1',\r\n    emitter:{\r\n      quantity: 7,\r\n      frame: { frames: [ 'particle-raccoon0', 'particle-raccoon1', 'particle-raccoon2', 'particle-raccoon3', 'particle-raccoon4', 'particle-raccoon5', 'particle-raccoon6' ], cycle: true },\r\n      frequency:1,\r\n      visible: false,\r\n      tint: 0xff0000,\r\n      speed: { min: 300, max: 500 },\r\n      angle: { min: 210, max: 330 },\r\n      scale: { start: .75, end: 1.1 },\r\n      lifespan: { min: 400, max: 800 },\r\n      gravityY: 2000\r\n    }\r\n  }\r\n}\r\nconst particles = {}\r\n/*\r\nclass AnimatedParticle extends Phaser.GameObjects.Particles.Particle\r\n{\r\n    constructor (emitter)\r\n    {\r\n        super(emitter);\r\n        this.frame = anim.frames\r\n\r\n        this.t = 0;\r\n        this.i = 0;\r\n    }\r\n\r\n    update (delta, step, processors)\r\n    {\r\n        var result = super.update(delta, step, processors);\r\n\r\n        this.t += delta;\r\n\r\n        if (this.t >= anim.msPerFrame)\r\n        {\r\n            this.i++;\r\n\r\n            if (this.i > 17)\r\n            {\r\n                this.i = 0;\r\n            }\r\n\r\n            this.frame = anim.frames[this.i].frame;\r\n            this.t -= anim.msPerFrame;\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n*/\r\n\r\nexport const createGame = () =>{\r\n  console.log('GAME: createGame');\r\n  points = { ...INITIAL_STATE_POINTS };\r\n\r\n  const config = {\r\n    type: Phaser.AUTO,\r\n    scale: {\r\n      parent: 'game-container',\r\n      mode: Phaser.Scale.FIT,\r\n      autoCenter: Phaser.Scale.CENTER_BOTH,\r\n      width: 900,\r\n      height: 500,\r\n      min: {\r\n        width: 90,\r\n        height: 50\r\n      },\r\n      max: {\r\n        width: 1600,\r\n        height: 1200\r\n      },\r\n      zoom: 1,  // Size of game canvas = game size * zoom\r\n    },\r\n    autoRound: false,\r\n    physics: {\r\n      default: 'arcade',\r\n      arcade: {\r\n        gravity: { y: 800 },\r\n        debug: false\r\n      }\r\n    },\r\n    scene: {\r\n      preload: preload,\r\n      create: create,\r\n      update: update\r\n    }\r\n  };\r\n\r\n  game = new Phaser.Game(config);\r\n  global.game = game;\r\n  global.gameActive = true;\r\n}\r\n\r\nglobal.stopGame = () => {\r\n  // if not, hasnt been loaded yet\r\n  if(sceneContext){\r\n    global.gameActive = false;\r\n    sceneContext.scene.stop();\r\n  }\r\n}\r\n\r\nglobal.startGame = () => {\r\n  global.gameActive = true;\r\n  sceneContext.scene.start();\r\n}\r\n\r\nglobal.setLevel = (levelIdx) => {\r\n  global.stopGame();\r\n  global.gameData.curLevel = levelIdx;\r\n  global.startGame();\r\n}\r\n\r\nfunction setSceneContext(context){\r\n  sceneContext = context;\r\n  global.scene = sceneContext;\r\n  LevelController.setContext(context);\r\n  SpawnController.setContext(context);\r\n}\r\n\r\nfunction preload() {\r\n  setSceneContext(this);\r\n  initSound(this, game);\r\n  preloadSound();\r\n\r\n  // particle images\r\n  Object.keys(particleDefs).forEach(k => {\r\n    if(particleDefs[k].image){\r\n      this.load.image(`particle_${k}`, particleDefs[k].image);\r\n    } else if(particleDefs[k].atlas) {\r\n      this.load.atlas(`particle_${k}`, `${particleDefs[k].atlas}.png`, `${particleDefs[k].atlas}.json`);\r\n    }\r\n  });\r\n\r\n  LevelController.preload();\r\n  SpawnController.preload();\r\n}\r\n\r\nfunction getLevel() {\r\n  return gameData.levels[global.gameData.curLevel];\r\n}\r\n\r\nfunction getScene(){\r\n  const level = gameData.levels[global.gameData.curLevel];\r\n  return gameData.scenes[level.sceneKey];\r\n}\r\n\r\nfunction create() {\r\n  //- make the level\r\n  levelGroups = LevelController.create(getScene());\r\n  Events.on('interface', onInterface, this);\r\n  // var spritemap = this.cache.json.get('sfx').spritemap;\r\n\r\n  let spawnGroups = SpawnController.create(gameData.entities, getLevel(), getScene());\r\n\r\n  this.physics.add.collider(spawnGroups.enemies, levelGroups.platforms, null, collider_enemyAndPlatform, this);\r\n  this.physics.add.collider(spawnGroups.bowls, levelGroups.platforms);\r\n  this.physics.add.overlap(spawnGroups.enemies, spawnGroups.bowls, trigger_enemyAndBowl, null, this);\r\n  this.physics.add.overlap(spawnGroups.bowls, levelGroups.leftTrigger, trigger_itemAtStart, null, this);\r\n  this.physics.add.overlap(spawnGroups.enemies, levelGroups.rightTrigger, trigger_enemyAtEnd, null, this);\r\n  this.physics.add.overlap(spawnGroups.enemies, spawnGroups.player, trigger_enemyAndPlayer, null, this);\r\n\r\n  this.input.on('gameobjectdown', onObjectClicked);\r\n  this.input.keyboard.on('keydown', onKeyDown);\r\n\r\n  addParticles();\r\n}\r\nfunction update (){\r\n  SpawnController.update();\r\n}\r\n\r\nfunction onInterface(event, data){\r\n  global.gameInterface && global.gameInterface(event, data)\r\n}\r\n\r\nfunction trigger_enemyAtEnd(enemy, trigger){\r\n  switch(enemy.status){\r\n    case STATUS_ENEMY.ROAMING_TAME:\r\n      playSound(SOUNDS.ENEMY_CAPTURED);\r\n      spawnStatus('tame', enemy.body.x, enemy.body.y);\r\n      setPoints('captures', 1);\r\n      enemy.captured();\r\n      break;\r\n    case STATUS_ENEMY.ROAMING:\r\n      playSound(SOUNDS.ENEMY_ESCAPED);\r\n      spawnStatus('lost', enemy.body.x, enemy.body.y);\r\n      setPoints('escapes', 1);\r\n      enemy.escaped();\r\n      break;\r\n    default: break;\r\n  }\r\n}\r\n\r\nfunction trigger_itemAtStart(item, trigger){\r\n  spawnStatus('lost', item.body.x, item.body.y);\r\n  item.destroy();\r\n  setPoints('bowls', 1);\r\n  playSound(SOUNDS.BOWL_LOST);\r\n}\r\n\r\nfunction trigger_enemyAndBowl(enemy, bowl){\r\n  if(enemy.canEat() && bowl.canBeEaten){\r\n    enemy.eatAtBowl(bowl.body);\r\n    bowl.eatenBy(enemy);\r\n  }\r\n}\r\n\r\nfunction collider_enemyAndPlatform(enemy, platform){\r\n  return true;\r\n}\r\n\r\nfunction trigger_enemyAndPlayer(enemy, player){\r\n  if(enemy.isAlive()){\r\n    // first off, is player is kicking, punt that thing\r\n    if(player.checkStatus(STATUS_PLAYER.KICK) && player.getKickStrength() > 0){\r\n      kickEnemy(player, enemy);\r\n    }else{\r\n    // otherwise, see if its good or bad\r\n      // get bitten by mean boys.\r\n      if(!enemy.isFull && !enemy.checkStatus(STATUS_ENEMY.BITING)){\r\n        playSound(SOUNDS.ENEMY_BITE);\r\n        spawnStatus('bite', enemy.body.x, enemy.body.y, enemy.depth);\r\n        bitePlayer(player, enemy);\r\n      }else{\r\n        // good raccoons get a bonus from a hug, dont hug more than once now\r\n        if(player.checkStatus(STATUS_PLAYER.HUGGING) && !enemy.checkStatus(STATUS_ENEMY.HUGGING)){\r\n          playSound(SOUNDS.ENEMY_HUG);\r\n          spawnStatus('hug', enemy.body.x, enemy.body.y, enemy.depth);\r\n          hugEnemy(player, enemy);\r\n        }\r\n        // already got your hug lil dude, move along\r\n      }\r\n    }\r\n  }\r\n\r\n  //- anything else, just walk on by\r\n}\r\n\r\nfunction kickEnemy(player, enemy){\r\n  const kickStrength = player.getKickStrength();\r\n  if(enemy.punt){\r\n    if(!enemy.punted){\r\n      const willKill = (kickStrength >= enemy.puntKillThreshold);\r\n      enemy.punt(kickStrength);\r\n      if(willKill){\r\n        playSound(SOUNDS.KICK);\r\n        showParticle('blood', enemy.body.x, enemy.body.y);\r\n        if(enemy.particleDeath) showParticle(enemy.particleDeath,  enemy.body.x, enemy.body.y);\r\n        \r\n        enemy.kill(true);\r\n      }else{\r\n        // soft punt sound\r\n        const thudVolume = .3 * kickStrength\r\n        playSound(SOUNDS.KICK, { volume: thudVolume });\r\n      }\r\n    }\r\n  }else{\r\n    showParticle('blood',  enemy.body.x, enemy.body.y);\r\n    if(enemy.particleDeath) showParticle(enemy.particleDeath,  enemy.body.x, enemy.body.y);\r\n    enemy.kill(true);\r\n  }\r\n}\r\n\r\nfunction hugEnemy(player, enemy){\r\n  enemy.hug();\r\n  player.onHugEnemy();\r\n  setPoints('hugs', 1);\r\n}\r\n\r\nfunction bitePlayer(player, enemy){\r\n  enemy.bite();\r\n  player.onAttackedByEnemy();\r\n  setPoints('bites', 1);\r\n}\r\n\r\nfunction onObjectClicked(pointer, gameObject){\r\n  if(gameObject.type === 'raccoon'){\r\n    if(gameObject.particleDeath) showParticle(gameObject.particleDeath,  pointer.worldX, pointer.worldY);\r\n    spawnStatus('lost', gameObject.body.x, gameObject.body.y);\r\n    gameObject.clicked();\r\n  }\r\n}\r\n\r\nfunction showParticle(type, x, y){\r\n  const pDef = particleDefs[type];\r\n  let config = pDef.emitter;\r\n\r\n  let pEmitter = particles[type].createEmitter(config);\r\n\r\n  pEmitter.setPosition(x, y);\r\n  pEmitter.explode();\r\n  pEmitter.visible = true;\r\n  if(pDef.sound){\r\n    playSound(SOUNDS.SPLAT);\r\n  }\r\n}\r\n\r\nfunction addParticles(){\r\n  Object.keys(particleDefs).forEach(k => {\r\n    particles[k] = sceneContext.add.particles(`particle_${k}`);\r\n  });\r\n}\r\n\r\nconst onKeyDown = (e) => {\r\n  switch(e.code){\r\n    case 'Space': SpawnController.slingBowl();\r\n      break;\r\n    default: break;\r\n  }\r\n}\r\n\r\nconst setPoints = (key, change) => {\r\n  points[key] += change;\r\n\r\n  updateScoreboard(key, points[key]);\r\n}\r\n\r\nconst updateScoreboard = (key, value) => {\r\n  Events.emit('interface', 'setMetric', { 'key': key, 'value': value });\r\n}\r\n\r\n\r\nexport const externalCommand = (event, payload) => {\r\n  console.log('externalCommand:', event, payload);\r\n}\r\n\r\nexport const pauseGame = () => {\r\n  console.log('GAME: pauseGame');\r\n  sceneContext?.scene?.pause();\r\n}\r\n\r\nexport const resumeGame = () => {\r\n  console.log('GAME: resumeGame');\r\n  if(global.gameActive){\r\n    sceneContext?.scene?.resume();\r\n  }\r\n}\r\n\r\nexport const killGame = () => {\r\n  console.log('GAME: killGame');\r\n  if(global.gameActive){\r\n    global.stopGame();\r\n    game.destroy();\r\n    game = null;\r\n    sceneContext = null;\r\n    levelGroups = null;\r\n  }\r\n}","// slightly evolving from create-react-app example\r\nimport { createAsyncThunk, createSlice, PayloadAction } from '@reduxjs/toolkit';\r\n\r\nimport { RootState, AppThunk } from '../store';\r\n\r\nexport function fetchThing(amount = 1) {\r\n  return new Promise<{ data: number }>((resolve) =>\r\n    setTimeout(() => resolve({ data: amount }), 500)\r\n  );\r\n}\r\n\r\nexport interface UiState {\r\n  value: number;\r\n  status: 'idle' | 'loading' | 'failed';\r\n}\r\n\r\nconst initialState: UiState = {\r\n  value: 0,\r\n  status: 'idle'\r\n};\r\n\r\n// The function below is called a thunk and allows us to perform async logic. It\r\n// can be dispatched like a regular action: `dispatch(incrementAsync(10))`. This\r\n// will call the thunk with the `dispatch` function as the first argument. Async\r\n// code can then be executed and other actions can be dispatched. Thunks are\r\n// typically used to make async requests.\r\nexport const incrementAsync = createAsyncThunk(\r\n  'ui/fetchThing',\r\n  async (amount: number) => {\r\n    const response = await fetchThing(amount);\r\n    // The value we return becomes the `fulfilled` action payload\r\n    return response.data;\r\n  }\r\n);\r\n\r\nexport const uiSlice = createSlice({\r\n  name: 'ui',\r\n  initialState,\r\n  // The `reducers` field lets us define reducers and generate associated actions\r\n  reducers: {\r\n    increment: (state) => {\r\n      // Redux Toolkit allows us to write \"mutating\" logic in reducers. It\r\n      // doesn't actually mutate the state because it uses the Immer library,\r\n      // which detects changes to a \"draft state\" and produces a brand new\r\n      // immutable state based off those changes\r\n      state.value += 1;\r\n    },\r\n    decrement: (state) => {\r\n      state.value -= 1;\r\n    },\r\n    // Use the PayloadAction type to declare the contents of `action.payload`\r\n    incrementByAmount: (state, action: PayloadAction<number>) => {\r\n      state.value += action.payload;\r\n    },\r\n  },\r\n  // The `extraReducers` field lets the slice handle actions defined elsewhere,\r\n  // including actions generated by createAsyncThunk or in other slices.\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(incrementAsync.pending, (state) => {\r\n        state.status = 'loading';\r\n      })\r\n      .addCase(incrementAsync.fulfilled, (state, action) => {\r\n        state.status = 'idle';\r\n        state.value += action.payload;\r\n      });\r\n  },\r\n});\r\n\r\nexport const { increment, decrement, incrementByAmount } = uiSlice.actions;\r\n\r\n// The function below is called a selector and allows us to select a value from\r\n// the state. Selectors can also be defined inline where they're used instead of\r\n// in the slice file. For example: `useSelector((state: RootState) => state.counter.value)`\r\nexport const selectCount = (state: RootState) => state.ui.value;\r\n\r\n// We can also write thunks by hand, which may contain both sync and async logic.\r\n// Here's an example of conditionally dispatching actions based on current state.\r\nexport const incrementIfOdd = (amount: number): AppThunk => (\r\n  dispatch,\r\n  getState\r\n) => {\r\n  const currentValue = selectCount(getState());\r\n  if (currentValue % 2 === 1) {\r\n    dispatch(incrementByAmount(amount));\r\n  }\r\n};\r\n\r\nexport default uiSlice.reducer;\r\n","import { combineReducers } from 'redux'\r\nimport metricsReducer from './metrics-slice';\r\nimport statusReducer from './status-slice';\r\n\r\nexport default combineReducers({\r\n  metrics: metricsReducer,\r\n  status: statusReducer\r\n})","import { configureStore, ThunkAction, Action } from '@reduxjs/toolkit';\r\nimport uiReducer from './ui/ui-slice';\r\nimport gameReducer from './game/reducer';\r\n\r\nexport const store = configureStore({\r\n  reducer: {\r\n    ui: uiReducer,\r\n    game: gameReducer,\r\n  },\r\n});\r\n\r\nexport type AppDispatch = typeof store.dispatch;\r\nexport type RootState = ReturnType<typeof store.getState>;\r\nexport type AppThunk<ReturnType = void> = ThunkAction<\r\n  ReturnType,\r\n  RootState,\r\n  unknown,\r\n  Action<string>\r\n>;\r\n","import Phaser from 'phaser';\r\nimport Values from '../utils/values';\r\n\r\nconst SPRITE_KEY = 'statuses';\r\n\r\n// ranges for how the status pops out\r\nconst rY = [ -200, -300 ];\r\nconst rX = [ -50, 50 ];\r\n\r\nconst DESTROY_TIMEOUT = 5000;\r\nconst OFFSET = {\r\n  x: 0,\r\n  y: 0\r\n};\r\n\r\nclass Entity extends Phaser.Physics.Arcade.Sprite {\r\n  constructor (scene, x, y, statType, depth) {\r\n    super(scene, x, y, 'status');\r\n\r\n    this.statType = statType;\r\n\r\n    if(!depth){\r\n      depth = Values.zindex.FOREGROUND;\r\n    }\r\n    this.setDepth(depth + 1);\r\n    this.setOffsetPosition(x, y);\r\n    this.playAnimationForType();\r\n    scene.add.existing(this);\r\n    scene.physics.add.existing(this);\r\n    this.allowGravity = true;\r\n    this.setDrag(0);\r\n\r\n    const vX = Phaser.Math.Between(rX[0], rX[1]);\r\n    const vY = Phaser.Math.Between(rY[0], rY[1]);\r\n    this.setVelocity(vX, vY);\r\n\r\n    this.alpha = 1;\r\n    scene.tweens.add({\r\n      targets: this,\r\n      alpha: 0,\r\n      duration: 500,\r\n      delay: 300,\r\n      ease: 'Cubic',\r\n      repeat: 0\r\n    });\r\n\r\n    this.destroyTimer = scene.time.delayedCall(DESTROY_TIMEOUT, () => {\r\n      this.destroy();\r\n    });\r\n  }\r\n\r\n  setOffsetPosition(x, y){\r\n    this.setPosition(x + OFFSET.x, y + OFFSET.y);\r\n  }\r\n\r\n  playAnimationForType(){\r\n    this.anims.play(`status_${this.statType}`);\r\n  }\r\n\r\n  update(){\r\n  }\r\n}\r\n\r\n\r\nconst initSprites = (sceneContext) => {\r\n  sceneContext.anims.create({\r\n    key: 'status_bite',\r\n    frames: sceneContext.anims.generateFrameNumbers(SPRITE_KEY, { start: 0, end: 4 }),\r\n    frameRate: 12,\r\n    repeat: 0,\r\n  });\r\n  \r\n  sceneContext.anims.create({\r\n    key: 'status_hug',\r\n    frames: sceneContext.anims.generateFrameNumbers(SPRITE_KEY, { start: 5, end: 9 }),\r\n    frameRate: 12,\r\n    repeat: 0,\r\n  });\r\n  \r\n  sceneContext.anims.create({\r\n    key: 'status_lost',\r\n    frames: sceneContext.anims.generateFrameNumbers(SPRITE_KEY, { start: 10, end: 14 }),\r\n    frameRate: 12,\r\n    repeat: 0,\r\n  });\r\n  \r\n  sceneContext.anims.create({\r\n    key: 'status_tame',\r\n    frames: sceneContext.anims.generateFrameNumbers(SPRITE_KEY, { start: 15, end: 19 }),\r\n    frameRate: 12,\r\n    repeat: 0,\r\n  });\r\n}\r\n\r\nconst initSpritesheet = (sceneContext) => {\r\n  sceneContext.load.spritesheet(SPRITE_KEY, './assets/sprites/statuses.png', { frameWidth: 80, frameHeight: 50 } )\r\n}\r\n\r\nconst exportMap = {\r\n  Entity,\r\n  initSprites,\r\n  initSpritesheet,\r\n}\r\nexport default exportMap; ","import Values from './utils/values';\r\n\r\nconst DEBUG_ALPHA = 0;\r\nconst TRIGGER_DIMS = {\r\n  width: 25,\r\n  height: 100\r\n};\r\n\r\nlet sceneContext;\r\n\r\nexport const setContext = (context) => {\r\n  sceneContext = context;\r\n}\r\n\r\nexport const preload = () => {\r\n  sceneContext.load.image('bg', './assets/levels/level-backyard-0.jpg');\r\n  sceneContext.load.image('lane1', './assets/levels/level-backyard-1.png');\r\n  sceneContext.load.image('lane2', './assets/levels/level-backyard-2.png');\r\n  sceneContext.load.image('lane3', './assets/levels/level-backyard-3.png');\r\n  sceneContext.load.image('fg', './assets/levels/level-backyard-4.png');\r\n  // sceneContext.load.image('fg-yard', './assets/yard-fg.png');\r\n  // sceneContext.load.image('lane4-yard', './assets/yard-lane4.png');\r\n}\r\n\r\nexport const create = (levelData) => {\r\n\r\n  const platforms = sceneContext.physics.add.staticGroup();\r\n  const leftTrigger = sceneContext.physics.add.staticGroup();\r\n  const rightTrigger = sceneContext.physics.add.staticGroup();\r\n  // sceneContext.make.sprite(50, 50, 'bg-yard');\r\n  \r\n  sceneContext.add.image(0, 0, 'bg').setOrigin(0).setScale(1).setDepth(Values.zindex.BACKGROUND);\r\n  sceneContext.add.image(0, 0, 'lane1').setOrigin(0).setScale(1).setDepth(Values.zindex.LANE_2);\r\n  sceneContext.add.image(0, 0, 'lane2').setOrigin(0).setScale(1).setDepth(Values.zindex.LANE_3);\r\n  sceneContext.add.image(0, 0, 'lane3').setOrigin(0).setScale(1).setDepth(Values.zindex.LANE_4);\r\n  sceneContext.add.image(0, 0, 'fg').setOrigin(0).setScale(1).setDepth(Values.zindex.FOREGROUND);\r\n  const GAME_WIDTH = 900;\r\n\r\n  levelData.lanes.forEach(pO => {\r\n    const triggerY = pO.y - TRIGGER_DIMS.height;\r\n    // lets animals keep walkin past trigger, otherwise keep it at pO.width\r\n    const platformWidth = GAME_WIDTH - pO.x;\r\n\r\n    platforms.create(pO.x, pO.y, 'platform-floor').setDisplaySize(platformWidth, pO.height).setOrigin(0,0).setAlpha(DEBUG_ALPHA).refreshBody();\r\n    leftTrigger.create(pO.x, triggerY, 'trigger-spawn').setDisplaySize(TRIGGER_DIMS.width, TRIGGER_DIMS.height).setOrigin(0,0).setAlpha(DEBUG_ALPHA).refreshBody();\r\n    rightTrigger.create(pO.x + pO.width - TRIGGER_DIMS.width, triggerY, 'trigger-end').setDisplaySize(TRIGGER_DIMS.width, TRIGGER_DIMS.height).setOrigin(0,0).setAlpha(DEBUG_ALPHA).refreshBody();\r\n  });\r\n\r\n  return {\r\n    platforms,\r\n    leftTrigger,\r\n    rightTrigger\r\n  }\r\n}\r\n\r\nconst exportMap = {\r\n  setContext,\r\n  preload,\r\n  create\r\n}\r\nexport default exportMap; ","import { setMetric } from '../../services/game/metrics-slice';\r\nimport { store } from '../../services/store';\r\n\r\nexport const createGameInterface = () => {\r\n  if(!(global as any).gameInterface){\r\n    (global as any).gameInterface = (event: string, payload: any) => {\r\n      switch(event){\r\n        case 'setMetric': \r\n          store.dispatch(setMetric(payload))\r\n          break;\r\n        default: console.error('invalid interface command', event);\r\n      }\r\n    }\r\n  }\r\n  return;\r\n}\r\n","import { createGlobalStyle } from \"styled-components\"\r\n\r\nexport default createGlobalStyle`\r\n  *{\r\n    margin: 0;\r\n    padding: 0;\r\n    outline:0;\r\n    box-sizing:border-box;\r\n  }\r\n  #root{\r\n    margin:0 auto;\r\n  }\r\n  h1, h2, h3, h4{\r\n    font-family: 'Ranchers', cursive;\r\n  }\r\n  a, p, span, h5, h6{\r\n    font-family: 'Cabin', sans-serif;\r\n  }\r\n  h1{\r\n    font-size: 5rem;\r\n  }\r\n  h2{\r\n    font-size: 4rem;\r\n  }\r\n  h3{\r\n    font-size: 3.5rem;\r\n  }\r\n  h4{\r\n    font-size: 2.5rem;\r\n  }\r\n  h5{\r\n    font-size: 2rem;\r\n  }\r\n  p, span{\r\n    font-size:2rem;\r\n  }\r\n\r\n  html{\r\n    font-size: 62.5%;\r\n    -webkit-font-smoothing: antialiased;\r\n    -moz-osx-font-smoothing: grayscale;\r\n    font-family: 'Cabin', sans-serif;\r\n    background-color: black;\r\n  }\r\n  \r\n  code {\r\n    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New', monospace;\r\n  }\r\n`\r\n\r\n/*\r\nexport const mixinFontFamily = (style) => {\r\n  switch(style){\r\n    case 'details' : return css`font-family: 'Roboto', sans-serif`;\r\n    case 'display': return css`font-family: 'Bevan', cursive`;\r\n    default: return css`font-family: 'Roboto', sans-serif`;\r\n  }\r\n}\r\n*/\r\nexport const listColors = () => {\r\n  return Object.keys(store.colors);\r\n}\r\n\r\n\r\nexport const getColor = (colorId: tColor) => {\r\n  return store.colors[colorId] as CssString; \r\n}\r\n\r\nexport const getShadow = (shadowId: tShadow) => {\r\n  return store.shadows[shadowId] as CssString;\r\n}\r\n\r\nexport const getBreakpoint = (breakpointId: tBreakpoint) => {\r\n  return store.breakpoints[breakpointId] as CssString;\r\n}\r\n\r\ntype CssString = string;\r\n\r\ntype tShadow = 'z1' | 'z2' | 'z3';\r\nconst shadows = {\r\n  z1: '-0.1rem 0.1rem .25rem .1rem rgba(0,0,0,0.16)',\r\n  z2: '-0.1rem 0.1rem .25rem .1rem rgba(0,0,0,0.36)',\r\n  z3: '-.2rem .5rem 1rem .2rem rgba(0,0,0,.36)'\r\n}\r\ntype tColor = 'black' | 'white' | 'grey' | 'grey_light' | 'grey_dark' | 'pink' | 'brown' | 'brown_light' | 'brown_dark' | 'tan' | 'red' | 'green' | 'green_light';\r\nconst colors = {\r\n  black: '#000000',\r\n  white: '#FFFFFF',\r\n  grey: '#847E87',\r\n  grey_light: '#9BADB7',\r\n  grey_dark: '#222034',\r\n  pink: '#D77BBA',\r\n  brown: '#915539',\r\n  brown_light: '#D8A065',\r\n  brown_dark: '#663A31',\r\n  tan: '#EEC39A',\r\n  red: '#AE3232',\r\n  green: '#6BBE30',\r\n  green_light: '#99E54F'\r\n}\r\n\r\ntype tBreakpoint = 'mobile_tiny' | 'mobile_medium' | 'mobile_large' | 'tablet' | 'desktop';\r\nconst breakpoints = {\r\n  mobile_tiny: '300px',\r\n  mobile_medium: '400px',\r\n  mobile_large: '500px',\r\n  tablet: '768px',\r\n  desktop: '1024px'\r\n}\r\n\r\ntype ThemeStore = {\r\n  colors: typeof colors,\r\n  shadows: typeof shadows,\r\n  breakpoints: typeof breakpoints\r\n}\r\n\r\nexport const store: ThemeStore = {\r\n  colors: colors,\r\n  shadows: shadows,\r\n  breakpoints: breakpoints\r\n}\r\n","import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux';\r\n\r\nimport type { RootState, AppDispatch } from './store';\r\n\r\n// Use throughout your app instead of plain `useDispatch` and `useSelector`\r\nexport const useAppDispatch = () => useDispatch<AppDispatch>();\r\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;","export const evaluateExpression = (condition: StringCondition, criteria: number, value: number) => {\r\n  switch(condition){\r\n    case '=':\r\n      return value === criteria;\r\n    case '<':\r\n      return value < criteria;\r\n    case '<=':\r\n      return value <= criteria;\r\n    case '>':\r\n      return value > criteria;\r\n    case '>=':\r\n      return value >= criteria;\r\n    default: return false;\r\n  }\r\n}\r\n\r\nexport const checkMetricRules = (metricRules: Array<MetricRule>, stateMetrics: GameMetrics) => {\r\n  return metricRules.map(m => {\r\n    if(checkMetricRule(m, stateMetrics[m.metric])) return m.result;\r\n    return null;\r\n  }).filter(result => !!result) as Array<string>;\r\n}\r\n\r\nexport const checkMetricRule = (metricRule: MetricRule, stateValue: number) => {\r\n  return evaluateExpression(metricRule.condition, metricRule.value, stateValue)\r\n}\r\n\r\n\r\n\r\nexport const evaluateGameConditions = (gameConditions: Array<GameCondition>, results: Array<string>) => {\r\n  const resultObjs = [];\r\n  for(let i = 0; i < gameConditions.length; i++){\r\n    const passedCondition = evaluateGameCondition(gameConditions[i], results);\r\n    if(passedCondition){\r\n      resultObjs.push({\r\n        action: passedCondition.then,\r\n        reason: passedCondition.reason\r\n      });\r\n      if(passedCondition.halt){\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return resultObjs;\r\n}\r\n\r\nexport const evaluateGameCondition = (gameCondition: GameCondition, results: Array<string>) => {\r\n  for(let i = 0; i < gameCondition.when.length; i++){\r\n    if(!results.some(gc => gc === gameCondition.when[i])){\r\n      return null;\r\n    }\r\n  }\r\n\r\n  return gameCondition;\r\n}","import { useEffect } from 'react';\r\nimport { selectMetricsMap } from '../../services/game/metrics-slice';\r\nimport { loseRound, winRound, selectPlayStatus } from '../../services/game/status-slice';\r\nimport { useAppSelector } from '../../services/hooks';\r\nimport RulesJson from './rules.json';\r\nimport { checkMetricRules, evaluateGameConditions } from './rules-checker';\r\nimport { useDispatch } from 'react-redux';\r\n\r\nconst getRulesObj = () => {\r\n  return RulesJson.TRAPPER as RulesDefinition;\r\n}\r\n\r\nexport function Brain() {\r\n  const dispatch = useDispatch();\r\n  const metrics = useAppSelector(selectMetricsMap);\r\n  const playStatus = useAppSelector(selectPlayStatus);\r\n\r\n  useEffect(() => {\r\n    // if game isnt running, no need to check win conditions\r\n    if(playStatus === 'playing'){\r\n      const rules = getRulesObj();\r\n      // get back a list of conditions based on rules, like \"you slang too many bowls!\"\r\n      const results = checkMetricRules(rules.metrics, metrics);\r\n  \r\n      const resultActions = evaluateGameConditions(rules.conditions, results);\r\n      resultActions.forEach(resultAction => {\r\n        switch(resultAction.action){\r\n          case 'LOSE': dispatch(loseRound(resultAction.reason)); break;\r\n          case 'WIN': dispatch(winRound(resultAction.reason)); break;\r\n          default: break;\r\n        }\r\n      })\r\n    }\r\n  }, [ metrics, playStatus, dispatch ])\r\n\r\n  return null;\r\n}\r\n","import styled from 'styled-components';\r\nimport { getColor } from '../../themes';\r\nimport { Brain } from './brain';\r\n\r\nexport const ScPhaserContainer = styled.div`\r\n  position:relative;\r\n  width:100%;\r\n  height:100%;\r\n\r\n  overflow-y:hidden;\r\n`;\r\n\r\nexport const ScWrapper = styled.div`\r\n  >canvas{\r\n    border: 1rem solid ${getColor('brown')};\r\n  }\r\n`;\r\n\r\nexport function PhaserContainer() {\r\n  return (\r\n    <ScPhaserContainer>\r\n      <Brain />\r\n      <ScWrapper id=\"game-container\">\r\n      </ScWrapper>\r\n    </ScPhaserContainer>\r\n  );\r\n}\r\n","import styled from 'styled-components';\r\nimport { MouseEventHandler } from 'hoist-non-react-statics/node_modules/@types/react';\r\n\r\nimport { getColor } from '../themes';\r\n\r\nexport const ScButton = styled.div`\r\n  display: inline-block;\r\n  padding: 2rem;\r\n  border: .5rem solid ${getColor('brown')};\r\n  border-radius: 1rem;\r\n  background-color: ${getColor('tan')};\r\n  width:auto;\r\n\r\n  cursor:pointer;\r\n  &:hover{\r\n    background-color: ${getColor('brown_light')};\r\n  }\r\n\r\n  span{\r\n    font-size:3rem;\r\n    font-weight: bold;\r\n  }\r\n`;\r\n\r\ninterface LBType {\r\n  onClick: MouseEventHandler,\r\n  text: string\r\n}\r\n\r\nexport function Button({ onClick, text }: LBType) {\r\n  return (\r\n    <ScButton onClick={onClick}><span>{text}</span></ScButton>\r\n  )\r\n}\r\n","import styled from 'styled-components';\r\nimport { NavigateFunction, useNavigate } from 'react-router-dom';\r\n\r\nimport { getColor } from '../../themes';\r\nimport { Button } from '../button';\r\n\r\n\r\nexport const ScSplash = styled.div`\r\n  margin: 0;\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  min-width: 25%;\r\n  min-height: 25%;\r\n  transform: translate(-50%, -50%);\r\n  padding: 4rem;\r\n`;\r\n\r\nexport const ScBg = styled.div`\r\n  position:absolute;\r\n  top:0;\r\n  left:0;\r\n  width:100%;\r\n  height:100%;\r\n  background-color: ${getColor('brown_dark')};\r\n  border: 1rem solid ${getColor('brown')};\r\n  border-radius: 5rem;\r\n\r\n  z-index:-1;\r\n`;\r\n\r\nexport const ScBody = styled.div`\r\n`;\r\nexport const ScTitle = styled.h1`\r\n  text-align:center;\r\n  font-size:8rem;\r\n  color: ${getColor('tan')};\r\n`;\r\nexport const ScButtons = styled.div`\r\n  margin-top:1rem;\r\n  text-align:center;\r\n\r\n\r\n`;\r\nconst ScLogo = styled.div`\r\n  background: center / contain no-repeat url('./assets/logo.png');\r\n  width: 60rem;\r\n  height: 40rem;\r\n  margin:-2rem;\r\n`;\r\n\r\n\r\nconst onGameClick = (navigate: NavigateFunction) => {\r\n  // dispatch(startGame())\r\n  navigate('/game');\r\n}\r\n\r\nexport function Splash() {\r\n  const navigate = useNavigate();\r\n\r\n  return (\r\n    <ScSplash>\r\n      <ScBody>\r\n        <ScLogo title=\"RACCOON TRAPPER\" />\r\n      </ScBody>\r\n      <ScButtons>\r\n        <Button onClick={(e) => onGameClick(navigate)} text={'NEW GAME'} />;\r\n      </ScButtons>\r\n      <ScBg />\r\n    </ScSplash>\r\n  )\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport styled from 'styled-components';\r\n\r\nimport { useAppSelector } from '../../../services/hooks';\r\nimport { selectActiveEnemies } from '../../../services/game/metrics-slice';\r\nimport { external_setSpawnFrequency } from '../../../phaser/trapper/spawn';\r\n\r\nconst ScControls = styled.div`\r\n`;\r\n\r\nconst ScEnemies = styled.div`\r\n`;\r\n\r\nfunction Controls() {\r\n  const activeEnemies = useAppSelector(selectActiveEnemies);\r\n  const [ spawnSpeed, setSpawnSpeed ] = useState(20);\r\n\r\n  useEffect(() => {\r\n    external_setSpawnFrequency(spawnSpeed);\r\n  }, [ spawnSpeed ])\r\n\r\n  return (\r\n    <ScControls>\r\n  {/* <button className=\"level-button\" onClick=\"setLevel(0);\">Set Level 1</button>\r\n      <button className=\"level-button\" onClick=\"setLevel(1);\">Set Level 2</button> */}\r\n      <p>{'spawn speed'}</p>\r\n      \r\n      <input id=\"spawn-slider\" className=\"slider\" type=\"range\" min=\"0\" max=\"100\" value={spawnSpeed} onChange={e => setSpawnSpeed(+(e.target.value))}/>\r\n      <p>{`spawn rate: ${spawnSpeed}%`}</p>\r\n      <ScEnemies>\r\n        <span>{'Enemies:'}</span>\r\n        <span>{activeEnemies}</span>\r\n      </ScEnemies>\r\n    </ScControls>\r\n  )\r\n}\r\n\r\nexport default Controls;\r\n\r\n/*\r\n<div className=\"control-group\">\r\n<p>Spawn speed</p>\r\n<input id=\"spawn-slider\" className=\"slider\" type=\"range\" min=\"0\" max=\"100\" value=\"20\" onChange={() => {}}/>\r\n<span id=\"spawn-display\">20%</span>\r\n<div id=\"spawn-counter\"><span>Spawned:</span><span id=\"spawn-count\">0</span></div>\r\n</div>\r\n*/","import styled, { css } from 'styled-components';\r\n\r\nimport { useAppSelector } from '../../../services/hooks';\r\nimport { getColor } from '../../../themes';\r\nimport { selectGoodMetrics, selectScore, selectBadMetrics } from '../../../services/game/metrics-slice';\r\n\r\ntype StatsProps = {\r\n  statType: StatType;\r\n}\r\n\r\ntype StatType = 'good' | 'bad' | 'neutral'\r\n\r\nconst ScStats = styled.div`\r\n  position:absolute;\r\n  bottom:0;\r\n  left:0;\r\n  width:100%;\r\n  background-color: ${getColor('brown')};\r\n\r\n  color: ${getColor('white')};\r\n  padding: 1rem;\r\n  text-align:center;\r\n\r\n  >h4{\r\n    text-align:left;\r\n  }\r\n`;\r\n\r\nconst ScStatGroup = styled.div<StatsProps>`\r\n  vertical-align:top;\r\n  text-align:right;\r\n  display:inline-block;\r\n  width:calc(50% - .5rem);\r\n  margin-top:1rem;\r\n  padding:.5rem;\r\n  color: ${getColor('grey_dark')};\r\n\r\n  ${p => p.statType === 'good' && css`\r\n    background-color:${getColor('green')};\r\n  `}\r\n  ${p => p.statType === 'bad' && css`\r\n    background-color:${getColor('pink')};\r\n    margin-left:1rem;\r\n  `}\r\n\r\n  h4{\r\n    text-align:center;\r\n  }\r\n`;\r\n\r\nconst ScStat = styled.div`\r\n  display:block;\r\n`\r\n\r\nconst ScDebug = styled.div`\r\n  display:inline-block;\r\n  height:100%;\r\n  width:100%;\r\n  \r\n  span { font-size: 3rem; }\r\n  font-weight: bold;\r\n  text-align:right;\r\n  color: white;\r\n`\r\n\r\nexport function DebugStats() {\r\n  const goodStats = useAppSelector(selectGoodMetrics);\r\n  const badStats = useAppSelector(selectBadMetrics);\r\n  const score = useAppSelector(selectScore);\r\n\r\n  return (\r\n    <ScStats>\r\n      <h4>{'Debug and score'}</h4>\r\n      <ScStatGroup statType={'good'}>\r\n        <h4>{'Good Stuff'}</h4>\r\n        {goodStats.map((s, idx) => (\r\n          <ScStat key={idx} >\r\n            <span>{`${s.key}:`}</span><span>{s.value}</span>\r\n          </ScStat>\r\n        ))}\r\n      </ScStatGroup>\r\n      <ScStatGroup statType={'bad'}>\r\n        <h4>{'Bad Stuff'}</h4>\r\n        {badStats.map((s, idx) => (\r\n          <ScStat key={idx} >\r\n            <span>{`${s.key}:`}</span><span>{s.value}</span>\r\n          </ScStat>\r\n        ))}\r\n      </ScStatGroup>\r\n      <ScDebug>\r\n        <span>{'Score:'}</span>\r\n        <span>{score}</span>\r\n      </ScDebug>\r\n    </ScStats>\r\n  )\r\n}","import { useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport styled from 'styled-components';\r\n\r\nimport { getColor } from '../../themes/';\r\nimport Controls from './components/controls';\r\nimport { DebugStats } from './components/debugstats';\r\n\r\nconst ScSidebar = styled.div`\r\n  position:fixed;\r\n  top:0;\r\n  left:0;\r\n  transition:left .5s ease-in-out;\r\n\r\n  width:40rem;\r\n  height:100%;\r\n  margin:0;\r\n  color:${getColor('tan')};\r\n  z-index:1;\r\n\r\n  &.collapsed{\r\n    left:-40rem;\r\n    transition:left .5s ease-in-out;\r\n  }\r\n\r\n  >.link-button{\r\n    color:white;\r\n    display:inline-block;\r\n    vertical-align:middle;\r\n    margin:0rem 1.8rem;\r\n    margin-top:1.5rem;\r\n    transition:color .5s ease-in;\r\n    color:${getColor('tan')};\r\n    \r\n    h4{\r\n      font-size:2.5rem;\r\n    }\r\n    &:hover{\r\n      color: ${getColor('green_light')};\r\n      transition:color .2s ease-out;\r\n    }\r\n  }\r\n`;\r\n\r\nconst ScBg = styled.div`\r\n  position:absolute;\r\n  left:0;\r\n  right:0;\r\n  top:0;\r\n  bottom:0;\r\n  z-index:-1;\r\n  \r\n  background-color: ${getColor('brown_dark')};\r\n  border-right: .5rem solid ${getColor('brown')};\r\n`\r\n\r\nconst ScBody = styled.div`\r\n  display:flex;\r\n  flex-direction: column;\r\n  height:100%;\r\n`\r\n\r\n\r\nconst ScBottom = styled.div`\r\n  flex-grow:1;\r\n  overflow-y:auto;\r\n  padding:1rem;\r\n`\r\n\r\nconst ScTop = styled.div`\r\n  min-height:20rem;\r\n  position:relative;\r\n  cursor:pointer;\r\n  border-bottom:.5rem solid ${getColor('brown')};\r\n  padding:1rem;\r\n  padding-right:10rem;\r\n`\r\n\r\nconst ScLogo = styled.div`\r\n  background: center / contain no-repeat url('./assets/logo.gif');\r\n  position:absolute;\r\n  left:100%;\r\n  top:0;\r\n  width:30rem;\r\n  height:20rem;\r\n  z-index:1;\r\n\r\n  -webkit-filter: drop-shadow(.5rem .5rem .5rem ${getColor('grey_dark')});\r\n  filter: drop-shadow(.5rem .5rem .5rem ${getColor('grey_dark')});\r\n\r\n  &:hover{\r\n    -webkit-filter: drop-shadow(1rem 1rem 1rem ${getColor('tan')});\r\n    filter: drop-shadow(1rem 1rem 1rem ${getColor('tan')});\r\n  }\r\n`;\r\n\r\nconst ScLink = styled(Link)`\r\n  color:${getColor('tan')};\r\n  text-align:center;\r\n  font-size:2rem;\r\n\r\n  &:hover{\r\n    color:white;\r\n  }\r\n`\r\n\r\nconst ScHelp = styled.div`\r\n  li{\r\n    font-size:1.5rem;\r\n    margin-left:1rem;\r\n  }\r\n`\r\n\r\nconst ScSideImage = styled.div`\r\nbackground: center / contain no-repeat url('./assets/raccoon-on-branch.gif');\r\n  position:absolute;\r\n  left:100%;\r\n  width:20rem;\r\n  height:50rem;\r\n  -webkit-filter: drop-shadow(.5rem .5rem .5rem ${getColor('grey_dark')});\r\n  filter: drop-shadow(.5rem .5rem .5rem ${getColor('grey_dark')});\r\n\r\n  &:hover{\r\n    -webkit-filter: drop-shadow(1rem 1rem 1rem ${getColor('tan')});\r\n    filter: drop-shadow(1rem 1rem 1rem ${getColor('tan')});\r\n  }\r\n  top:0;\r\n  margin-left:-12rem;\r\n`\r\n\r\n\r\nconst HelpList = () => {\r\n  const controls = [\r\n    'Arrow Up/Down: Change lanes',\r\n    'Arrow Left: Hug',\r\n    'Arrow Right: Charge kick',\r\n    'Space: Throw food'\r\n  ];\r\n\r\n  const rules = [\r\n    'Don\\'t let feral raccoons in your house!',\r\n    '>>> 3 escapes loses the game',\r\n    'Feed the feral raccoons to tame them!',\r\n    'Give tame raccoons a nice hug to show them you care',\r\n    '>>> 3 hugs wins the game',\r\n    'Don\\'t even think about hugging feral raccoons',\r\n    '>>> If you get bit once, you lose!',\r\n    'Kick any raccoon you want',\r\n  ]\r\n  return (\r\n    <ScHelp>\r\n      <h4>{'Controls'}</h4>\r\n      <ul>\r\n        {controls.map((i, idx) => (\r\n          <li key={idx}>{i}</li>\r\n        ))}\r\n      </ul>\r\n      <h4>{'Rules'}</h4>\r\n      <ul>\r\n        {rules.map((i, idx) => (\r\n          <li key={idx}>{i}</li>\r\n        ))}\r\n      </ul>\r\n    </ScHelp>\r\n  )\r\n}\r\n\r\nfunction Sidebar() {\r\n  const [ collapsed, setCollapsed ] = useState(true);\r\n\r\n  return (\r\n    <ScSidebar className={ collapsed ? 'collapsed' : ''} >\r\n      <ScBody>\r\n        <ScTop>\r\n          <ScLogo onClick={() => setCollapsed(!collapsed)} /> \r\n          <ScSideImage onClick={() => setCollapsed(!collapsed)} />\r\n          <HelpList />\r\n          <ScLink to={'/'} >\r\n            {'back to main menu'}\r\n          </ScLink>\r\n        </ScTop>\r\n        <ScBottom>\r\n          <hr/>\r\n          <Controls/>\r\n          <hr/>\r\n          <DebugStats/>\r\n        </ScBottom>\r\n      </ScBody>\r\n      <ScBg />\r\n    </ScSidebar>\r\n  )\r\n}\r\n\r\nexport default Sidebar;\r\n","import styled from 'styled-components';\r\nimport { Link } from 'react-router-dom';\r\nimport { getColor } from '../../../themes';\r\n\r\nexport const ScModal = styled.div`\r\n`\r\n\r\nexport const ScBody = styled.div`\r\n`\r\n\r\nexport const ScBg = styled.div`\r\n  position:absolute;\r\n  top:0;\r\n  left:0;\r\n  width:100%;\r\n  height:100%;\r\n  background-color: ${getColor('brown_dark')};\r\n  border: 1rem solid ${getColor('brown')};\r\n  border-radius: 5rem;\r\n\r\n  z-index:-1;\r\n`;\r\n\r\nconst ScLink = styled(Link)`\r\n  color:${getColor('tan')};\r\n  text-align:center;\r\n  font-size:2rem;\r\n\r\n  &:hover{\r\n    color:white;\r\n  }\r\n`\r\n\r\ntype ModalProps = {\r\n  reason: string\r\n};\r\nfunction WonModal({ reason }: ModalProps){\r\n  return (\r\n    <ScModal>\r\n      <ScBody>\r\n        <h3>{'YOU WON!'}</h3>\r\n        <p>{reason}</p>\r\n        <ScLink to={'/'} >\r\n          {'back to main menu'}\r\n        </ScLink>\r\n      </ScBody>\r\n      <ScBg />\r\n    </ScModal>\r\n  )\r\n}\r\n\r\nfunction LostModal({ reason }: ModalProps){\r\n  return (\r\n    <ScModal>\r\n      <ScBody>\r\n        <h3>{'YOU LOST!'}</h3>\r\n        <p>{reason}</p>\r\n        <ScLink to={'/'} >\r\n          {'back to main menu'}\r\n        </ScLink>\r\n      </ScBody>\r\n      <ScBg />\r\n    </ScModal>\r\n  )\r\n}\r\n\r\nfunction PausedModal({ reason }: ModalProps){\r\n  return (\r\n    <ScModal>\r\n      <ScBody>\r\n        <h3>{'YOU PAUSED!'}</h3>\r\n        <p>{reason}</p>\r\n        <ScLink to={'/'} >\r\n          {'back to main menu'}\r\n        </ScLink>\r\n      </ScBody>\r\n      <ScBg />\r\n    </ScModal>\r\n  )\r\n}\r\n\r\ntype MultiModalProps = {\r\n  playStatusObj: PlayStatusObj\r\n};\r\nexport function MultiModal({ playStatusObj }: MultiModalProps){\r\n  switch(playStatusObj.status){\r\n    case 'won': return (<WonModal reason={playStatusObj.reason} />)\r\n    case 'lost': return (<LostModal reason={playStatusObj.reason} />)\r\n    case 'paused': return (<PausedModal reason={playStatusObj.reason} />)\r\n    default: break;\r\n  }\r\n  \r\n  return null;\r\n}","import styled from 'styled-components';\r\n\r\nimport { ReselectModalFromGameStatus } from '../../services/game/status-slice';\r\nimport { useAppSelector } from '../../services/hooks';\r\nimport { MultiModal } from './components/modals';\r\n\r\nexport const ScModals = styled.div`\r\n  margin: 0;\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  min-width: 25%;\r\n  min-height: 25%;\r\n  transform: translate(-50%, -50%);\r\n  padding: 4rem;\r\n\r\n  z-index:1;\r\n`;\r\n\r\nexport function Modals() {\r\n  const playStatusObj = useAppSelector(ReselectModalFromGameStatus);\r\n  if(!playStatusObj) return null;\r\n\r\n  return (\r\n    <ScModals>\r\n      <MultiModal playStatusObj={playStatusObj} />\r\n    </ScModals>\r\n  )\r\n}\r\n","import styled, { css } from 'styled-components';\r\nimport { useEffect, useState } from 'react';\r\nimport useSound from 'use-sound';\r\n\r\nconst ScMusic = styled.div`\r\n  position:fixed;\r\n  top:0;\r\n  right:0;\r\n  z-index:1;\r\n`\r\n\r\nexport function Music() {\r\n  const [playing, setPlaying] = useState(false);\r\n  const [play, { stop }] = useSound('./assets/sfx/trapper.ogg');\r\n\r\n  useEffect(() => {\r\n    if(playing){\r\n      play();\r\n    }else{\r\n      stop();\r\n    }\r\n  }, [ playing ])\r\n\r\n  return (\r\n    <ScMusic>\r\n      <button onClick={() => setPlaying(!playing)}>\r\n        {playing ? 'Stop background music' : 'Play background music'}\r\n      </button>\r\n    </ScMusic>\r\n  )\r\n}","import { useEffect } from 'react';\r\nimport { HashRouter, Route, Routes, useLocation } from 'react-router-dom';\r\nimport styled from 'styled-components';\r\n\r\nimport { PhaserContainer } from '../components/game/phaser-container';\r\nimport { Splash } from '../components/ui/splash';\r\nimport { useAppDispatch, useAppSelector } from '../services/hooks';\r\nimport { startGame, exitGame, selectGameStatus, selectPlayStatus } from '../services/game/status-slice';\r\nimport Sidebar from '../components/ui/sidebar';\r\nimport { createGame, killGame, resumeGame, pauseGame } from '../phaser/trapper';\r\nimport { getColor } from '../themes';\r\nimport { createGameInterface } from '../components/game/game-interface';\r\nimport { Modals } from '../components/ui/modals';\r\nimport { Music } from '../components/ui/components/music';\r\n\r\nexport const ScStage = styled.div`\r\n  position:absolute;\r\n  left:0rem;\r\n  top:0rem;\r\n  right:0rem;\r\n  bottom:0rem;\r\n  background-color:${getColor('brown_dark')};\r\n`\r\n\r\nexport const RouteReader = ({ dispatch }: any) => {\r\n  let location = useLocation();\r\n  \r\n  useEffect(() => {\r\n    if(location.pathname.indexOf('game') > -1){\r\n      dispatch(startGame());\r\n    }else{\r\n      dispatch(exitGame())\r\n    }\r\n  }, [ location, dispatch ]);\r\n\r\n  return null;\r\n}\r\n\r\nfunction App() {\r\n  const gameStatus = useAppSelector(selectGameStatus);\r\n  const playStatus = useAppSelector(selectPlayStatus);\r\n  const dispatch = useAppDispatch();\r\n  \r\n  // only need to do this once, hence the []\r\n  useEffect(() => {createGameInterface();}, [])\r\n  \r\n  const pages = [\r\n    {\r\n      route: '',\r\n      text: 'SPLASH',\r\n      element: <Splash />\r\n    },\r\n    {\r\n      route: '/game',\r\n      text: 'RACCOON TRAPPER',\r\n      element: <PhaserContainer />\r\n    }\r\n  ]\r\n\r\n  useEffect(() => {\r\n    if(playStatus === 'playing'){\r\n      resumeGame();\r\n    }else if(['won', 'lost', 'paused'].some(s => s === playStatus)){\r\n      pauseGame();\r\n    }\r\n  }, [ playStatus ]);\r\n\r\n  useEffect(() => {\r\n    if(gameStatus === 'active'){\r\n      createGame();\r\n    }else{\r\n      killGame();\r\n    }\r\n  }, [ gameStatus ]);\r\n  \r\n  return (\r\n    <HashRouter>\r\n      <RouteReader dispatch={dispatch}/>\r\n      <Sidebar />\r\n      <Modals />\r\n      <Music />\r\n      <ScStage>\r\n        <Routes>\r\n          {pages.map((p, i) => (\r\n            <Route key={i} path={p.route} element={p.element} />\r\n          ))}\r\n        </Routes>\r\n      </ScStage>\r\n    </HashRouter>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nimport App from './app';\r\nimport { store } from './services/store';\r\nimport { Provider } from 'react-redux';\r\nimport * as serviceWorker from './services/serviceWorker';\r\nimport './themes/fonts.css';\r\nimport GlobalStyle from './themes/';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <Provider store={store}>\r\n      <App />\r\n      <GlobalStyle />\r\n    </Provider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}